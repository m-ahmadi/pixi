{"version":3,"sources":["../../../../../src/js/app/map/visMap/mediator.js"],"names":["define","conf","u","groups","inst","g","tmpl","Handlebars","templates","ROOT","WORKERS_DIR","network","options","container","nodes","vis","DataSet","edges","nodeTypes","dataConvertor","autoResize","height","width","locale","clickToUse","configure","enabled","smooth","type","arrowStrikethrough","borderWidth","shape","color","size","font","face","layout","improvedLayout","interaction","hideEdgesOnDrag","hover","tooltipDelay","physics","t0","t1","createWorker","window","Worker","highlighter","onmessage","e","console","log","data","update","performance","now","length","warn","convertData","oldNodes","oldLinks","links","newData","newNodes","newEdges","Object","keys","forEach","k","node","add","id","label","name","management_ip","group","x","y","title","nodepopup","link","src","dest","isObj","source_id","to","destination_id","draw","postMessage","init","elementId","innerWidth","innerHeight","hW","hH","$","Network","on","workerHighlight","ajax","url","dataType","x1","x2","y1","y2","done","t","GRAYED_OUT_COLOR","active","highlightActive","neighbourhoodHighlight","i","edge","hiddenLabel","len","originalColor","targetId","connectedNodes","connectedEdges","o","returnType","toUpdateNodes","toUpdateEdges","get","undefined","getConnectedNodes","getConnectedEdges","push","clear","visMap"],"mappings":"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","file":"mediator.js","sourcesContent":["define([\"config\", \"core/util\", \"./groups\"], function (conf, u, groups) {\r\n\tvar inst = {},\r\n\t\tg = {},\r\n\t\ttmpl = Handlebars.templates;\r\n\t\r\n\tconst ROOT = conf.ROOT;\r\n\t\r\n\tg.WORKERS_DIR = `${ROOT}js/app/workers`;\r\n\tg.network = {};\r\n\tg.options = {};\r\n\tg.container = {};\r\n\tg.nodes = new vis.DataSet();\r\n\tg.edges = new vis.DataSet();\r\n\t\r\n\tg.nodeTypes = [\"type0\", \"type1\", \"type2\", \"type3\", \"type4\", \"type5\", \"type6\"];\r\n\tg.dataConvertor = {};\r\n\t\r\n\tg.options = {\r\n\t\tautoResize: true,\r\n\t\theight: \"100%\",\r\n\t\twidth: \"100%\",\r\n\t\tlocale: \"en\",\r\n\t//\tlocales: locales,\r\n\t\tclickToUse: false,\r\n\t\tconfigure: {\r\n\t\t\tenabled: false\r\n\t\t},\r\n\t\tedges: {\r\n\t\t\twidth: 1,\r\n\t\t\tsmooth: {\r\n\t\t\t\ttype: \"continuous\" // \"dynamic\", \"continuous\", \"discrete\", \"diagonalCross\", \"straightCross\", \"horizontal\", \"vertical\", \"curvedCW\", \"curvedCCW\", \"cubicBezier\"\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/* arrows: {\r\n\t\t\t\tto: {\r\n\t\t\t\t\tenabled: true,\r\n\t\t\t\t\tscaleFactor: 0.6,\r\n\t\t\t\t\ttype: \"arrow\"\r\n\t\t\t\t},\r\n\t\t\t\t\"from\": {\r\n\t\t\t\t\tenabled: true,\r\n\t\t\t\t\tscaleFactor: 0.2,\r\n\t\t\t\t\ttype: \"circle\"\r\n\t\t\t\t},\r\n\t\t\t\t\r\n\t\t\t}, */\r\n\t\t\tarrowStrikethrough: true // default true\r\n\t\t},\r\n\t\tnodes: {\r\n\t\t\tborderWidth: 1,\r\n\t\t\tshape: \"dot\",\r\n\t\t\tcolor: \"#4CAF50\",\r\n\t\t\tsize: 10,\r\n\t\t\tfont: {\r\n\t\t\t\tsize: 12,\r\n\t\t\t\tface: \"Tahoma\"\r\n\t\t\t}\r\n\t\t},\r\n\t\tgroups: groups,\r\n\t\tlayout: {\r\n\t\t\timprovedLayout: false\r\n\t\t},\r\n\t\tinteraction: {\r\n\t\t\thideEdgesOnDrag: true,\r\n\t\t\thover: true,\r\n\t\t\ttooltipDelay: 200\r\n\t\t},\r\n\t//\tmanipulation: {},\r\n\t\tphysics: false // true false\r\n\t};\r\n\t\r\n\tvar t0, t1;\r\n\t\r\n\tfunction createWorker() {\r\n\t\tif (window.Worker) {\r\n\t\t\tg.dataConvertor = new Worker(`${g.WORKERS_DIR}/dataConvertor.js`);\r\n\t\t\tg.highlighter = new Worker(`${g.WORKERS_DIR}/highlighter.js`);\r\n\t\t\t\r\n\t\t\tg.dataConvertor.onmessage = function (e) {\r\n\t\t\t\tconsole.log(\"convert is finished.\");\r\n\t\t\t\tvar data = e.data;\r\n\t\t\t\tg.nodes.update(data.nodes);\r\n\t\t\t\tg.edges.update(data.edges);\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tg.highlighter.onmessage = function (e) {\r\n\t\t\t\tt1 = performance.now();\r\n\t\t\t\tconsole.log(\"worker is finished: \"+ (t1-t0) );\r\n\t\t\t\tvar data = e.data,\r\n\t\t\t\t\tnodes = data.nodes,\r\n\t\t\t\t\tedges = data.edges\r\n\t\t\t\t\r\n\t\t\t\tif (nodes.length) {\r\n\t\t\t\t\tg.nodes.update(data.nodes);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (edges.length) {\r\n\t\t\t\t\tg.edges.update(data.edges);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Your browser doesn't support web workers.\");\r\n\t\t}\r\n\t}\r\n\tfunction convertData(data) {\r\n\t\tvar oldNodes = data.nodes,\r\n\t\t\toldLinks = data.links,\r\n\t\t\tnewData = {},\r\n\t\t\tnewNodes = [],\r\n\t\t\tnewEdges = [];\r\n\t\t\r\n\t\tObject.keys(oldNodes).forEach(function (k) {\r\n\t\t\tvar node = oldNodes[k];\r\n\t\t\t\r\n\t\t\tg.nodes.add({\r\n\t\t\t\tid: node.id,\r\n\t\t\t\tlabel: node.name || node.management_ip,\r\n\t\t\t\tgroup: g.nodeTypes[node.type],\r\n\t\t\t\tx: node.x,\r\n\t\t\t\ty: node.y,\r\n\t\t\t\ttitle: tmpl.nodepopup({name: node.name, id: node.id})\r\n\t\t\t});\r\n\t\t\t\r\n\t\t});\r\n\t\tObject.keys(oldLinks).forEach(function (k) {\r\n\t\t\tvar link = oldLinks[k],\r\n\t\t\t\tsrc = link.src,\r\n\t\t\t\tdest = link.dest;\r\n\t\t\t\r\n\t\t\tg.edges.add({\r\n\t\t\t\t/* from: link.src.id,\r\n\t\t\t\tto: link.dest.id */\r\n\t\t\t\t\r\n\t\t\t\t\"from\": u.isObj(src) ? src.id : src || link.source_id,\r\n\t\t\t\tto: u.isObj(dest) ? dest.id : dest || link.destination_id,\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\tnewData.nodes = newNodes;\r\n\t\tnewData.edges = newEdges;\r\n\t\treturn newData;\r\n\t}\r\n\tfunction draw(data) {\r\n\t\t// data = convertData(data);\r\n\t\tdata.nodeTypes = g.nodeTypes;\r\n\t\tg.dataConvertor.postMessage(data);\r\n\t\t\r\n\t\t// g.nodes.update(data.nodes);\r\n\t\t// g.edges.update(data.edges);\r\n\t\t\r\n\t\t// g.network.setData({nodes: data.nodes, edges: data.edges});\r\n\t}\r\n\tfunction init(elementId) {\r\n\t\tvar width = window.innerWidth,\r\n\t\t\theight = window.innerHeight,\r\n\t\t\thW = width / 2;\r\n\t\t\thH = height / 2;\r\n\t\t\r\n\t\tg.container = $(elementId);\r\n\t\tg.container.height(window.innerHeight);\r\n\t\t\r\n\t\tg.network = new vis.Network(g.container[0], {nodes: g.nodes, edges: g.edges}, g.options);\r\n\t\tg.network.on(\"click\", workerHighlight); // workerHighlight neighbourhoodHighlight\r\n\t\twindow.network = g.network;\r\n\t\t\r\n\t\t$(window).on(\"resize\", function () {\r\n\t\t\tg.container.height(window.innerHeight);\r\n\t\t});\r\n\t\t$.ajax({\r\n\t\t\turl: \"http://localhost:3000\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdataType: \"json\",\r\n\t\t\tdata: {\r\n\t\t\t\tx1: -1000,// -hW\r\n\t\t\t\tx2: 1000,// hW window.innerWidth,\r\n\t\t\t\ty1: -600, // -hH\r\n\t\t\t\ty2: 600 // hH window.innerHeight\r\n\t\t\t}\r\n\t\t})\r\n\t\t.done(function (data) {\r\n\t\t\tconsole.log(data);\r\n\t\t\tt = data;\r\n\t\t\tdraw(data);\r\n\t\t});\r\n\t\tcreateWorker();\r\n\t}\r\n\t\r\n\t\r\n\tvar GRAYED_OUT_COLOR = \"rgba(200, 200, 200, 0.5)\"; \"rgba(150, 150, 150, 0.75)\"\r\n\tvar active = false;\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tvar highlightActive = false;\r\n\tfunction neighbourhoodHighlight(e) {\r\n\t\tvar t0 = performance.now();\r\n\t\t\r\n\t\tvar network,\r\n\t\t\tnodes,\r\n\t\t\tedges,\r\n\t\t\tk, i, node, edge, hiddenLabel, len, originalColor,\r\n\t\t\tkeys,\r\n\t\t\ttargetId,\r\n\t\t\tconnectedNodes, connectedEdges,\r\n\t\t\to = {returnType: \"Object\"},\r\n\t\t\ttoUpdateNodes = [],\r\n\t\t\ttoUpdateEdges = [];\r\n\t\t\t\r\n\t\t\r\n\t\tnodes = g.nodes.get(o);\r\n\t\tedges = g.edges.get(o);\r\n\t\t\r\n\t\tif (e.nodes.length > 0) {\r\n\t\t\tnetwork = g.network;\r\n\t\t\thighlightActive = true;\r\n\t\t\ttargetId = e.nodes[0];\r\n\t\t\t\r\n\t\t\tkeys = Object.keys(nodes);\r\n\t\t\tlen = keys.length;\r\n\t\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\t\tnode = nodes[ keys[i] ];\r\n\t\t\t\thiddenLabel = node.hiddenLabel;\r\n\t\t\t\t\r\n\t\t\t\tnode.color = GRAYED_OUT_COLOR;\r\n\t\t\t\tif (hiddenLabel === undefined) {\r\n\t\t\t\t\tnode.hiddenLabel = node.label;\r\n\t\t\t\t\tnode.label = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconnectedNodes = network.getConnectedNodes(targetId); // array of ids\r\n\t\t\tlen = connectedNodes.length;\r\n\t\t\t\r\n\t\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\t\tnode = nodes[ connectedNodes[i] ];\r\n\t\t\t\thiddenLabel = node.hiddenLabel;\r\n\t\t\t\t\r\n\t\t\t\tnode.color = undefined;\r\n\t\t\t\tif (hiddenLabel !== undefined) {\r\n\t\t\t\t\tnode.label = hiddenLabel;\r\n\t\t\t\t\tnode.hiddenLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tnode = nodes[targetId];\r\n\t\t\thiddenLabel = node.hiddenLabel;\r\n\t\t\tnode.color = undefined;\r\n\t\t\tif (hiddenLabel !== undefined) {\r\n\t\t\t\tnode.label = hiddenLabel;\r\n\t\t\t\tnode.hiddenLabel = undefined;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tkeys = Object.keys(edges);\r\n\t\t\tlen = keys.length;\r\n\t\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\t\tedge = edges[ keys[i] ];\r\n\t\t\t\toriginalColor = edge.originalColor;\r\n\t\t\t\tif (originalColor === undefined) {\r\n\t\t\t\t\tedge.originalColor = edge.color;\r\n\t\t\t\t\tedge.color = GRAYED_OUT_COLOR;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconnectedEdges = network.getConnectedEdges(targetId); // array of ids\r\n\t\t\t\r\n\t\t\tlen = connectedEdges.length;\r\n\t\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\t\tedge = edges[ connectedEdges[i] ];\r\n\t\t\t\toriginalColor = edge.originalColor;\r\n\t\t\t\tif (originalColor !== undefined) {\r\n\t\t\t\t\tedge.color = originalColor;\r\n\t\t\t\t\tedge.originalColor = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t} else if (highlightActive === true) {\r\n\t\t\tkeys = Object.keys(nodes);\r\n\t\t\tlen = keys.length;\r\n\t\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\t\tnode = nodes[ keys[i] ];\r\n\t\t\t\thiddenLabel = node.hiddenLabel;\r\n\t\t\t\t\r\n\t\t\t\tnode.color = undefined;\r\n\t\t\t\tif (hiddenLabel !== undefined) {\r\n\t\t\t\t\tnode.label = hiddenLabel;\r\n\t\t\t\t\tnode.hiddenLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tkeys = Object.keys(edges);\r\n\t\t\tlen = keys.length;\r\n\t\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\t\tedge = edges[ keys[i] ];\r\n\t\t\t\toriginalColor = edge.originalColor;\r\n\t\t\t\tif (originalColor !== undefined) {\r\n\t\t\t\t\tedge.color = originalColor;\r\n\t\t\t\t\tedge.originalColor = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\thighlightActive = false\r\n\t\t}\r\n\t\t\r\n\t\tkeys = Object.keys(nodes);\r\n\t\tlen = keys.length;\r\n\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\ttoUpdateNodes.push( nodes[ keys[i] ] );\r\n\t\t}\r\n\t\t\r\n\t\tkeys = Object.keys(edges);\r\n\t\tlen = keys.length;\r\n\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\ttoUpdateEdges.push( edges[ keys[i] ] );\r\n\t\t}\r\n\t\t\r\n\t\tvar t1 = performance.now();\r\n\t\tconsole.log(\"took \" + (t1 - t0) + \" milliseconds.\");\r\n\t\t\r\n\t\tg.nodes.update(toUpdateNodes);\r\n\t\tg.edges.update(toUpdateEdges);\r\n\t}\r\n\t\r\n\tvar highlightActive = false;\r\n\tfunction workerHighlight(e) {\r\n\t\t\r\n\t\tvar targetId = e.nodes[0];\r\n\t\tvar network = g.network;\r\n\t\tvar o = {returnType: \"Object\"};\r\n\t\tvar data = {\r\n\t\t\tlen: e.nodes.length,\r\n\t\t\ttargetId: targetId,\r\n\t\t\tnodes: g.nodes.get(o),\r\n\t\t\tedges: g.edges.get(o),\r\n\t\t\tconnectedNodes: targetId ? network.getConnectedNodes(targetId) : [],\r\n\t\t\tconnectedEdges: targetId ? network.getConnectedEdges(targetId) : []\r\n\t\t};\r\n\t\t\r\n\t\tt0 = performance.now();\r\n\t\tg.highlighter.postMessage(data);\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tinst.convertData = convertData;\r\n\tinst.draw = draw;\r\n\tinst.init = init;\r\n\tinst.clear = function () {\r\n\t\tg.nodes.clear();\r\n\t\tg.edges.clear();\r\n\t};\r\n\tinst.g = g;\r\n\t\r\n\twindow.visMap = g;\r\n\treturn inst;\r\n});"]}