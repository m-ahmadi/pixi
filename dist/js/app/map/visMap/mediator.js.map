{"version":3,"sources":["../../../../../src/js/app/map/visMap/mediator.js"],"names":["define","CONF","u","groups","WORKERS_DIR","ROOT","inst","g","tmpl","Handlebars","templates","network","options","container","nodes","vis","DataSet","edges","nodeTypes","dataConvertor","autoResize","height","width","locale","clickToUse","configure","enabled","smooth","type","arrowStrikethrough","borderWidth","shape","color","size","font","face","layout","improvedLayout","interaction","hideEdgesOnDrag","hover","tooltipDelay","physics","t0","t1","createWorker","window","Worker","highlighter","onmessage","e","console","log","data","update","performance","now","length","warn","convertData","oldNodes","oldLinks","links","newData","newNodes","newEdges","Object","keys","forEach","k","node","add","id","label","name","management_ip","group","x","y","title","nodepopup","link","src","dest","isObj","source_id","to","destination_id","draw","postMessage","init","elementId","innerWidth","innerHeight","hW","hH","$","Network","on","workerHighlight","GRAYED_OUT_COLOR","active","highlightActive","neighbourhoodHighlight","i","edge","hiddenLabel","len","originalColor","targetId","connectedNodes","connectedEdges","o","returnType","toUpdateNodes","toUpdateEdges","get","undefined","getConnectedNodes","getConnectedEdges","push","clear","visMap"],"mappings":"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","file":"mediator.js","sourcesContent":["define([\"config\", \"core/util\", \"./groups\"], function (CONF, u, groups) {\r\n\tconst WORKERS_DIR = `${CONF.ROOT}js/app/map/visMap/workers`;\r\n\t\r\n\tlet inst = {};\r\n\tlet g = {};\r\n\tlet tmpl = Handlebars.templates;\r\n\t\r\n\tg.network = {};\r\n\tg.options = {};\r\n\tg.container = {};\r\n\tg.nodes = new vis.DataSet();\r\n\tg.edges = new vis.DataSet();\r\n\t\r\n\tg.nodeTypes = [\"type0\", \"type1\", \"type2\", \"type3\", \"type4\", \"type5\", \"type6\"];\r\n\tg.dataConvertor = {};\r\n\t\r\n\tg.options = {\r\n\t\tautoResize: true,\r\n\t\theight: \"100%\",\r\n\t\twidth: \"100%\",\r\n\t\tlocale: \"en\",\r\n\t//\tlocales: locales,\r\n\t\tclickToUse: false,\r\n\t\tconfigure: {\r\n\t\t\tenabled: false\r\n\t\t},\r\n\t\tedges: {\r\n\t\t\twidth: 1,\r\n\t\t\tsmooth: {\r\n\t\t\t\ttype: \"continuous\" // \"dynamic\", \"continuous\", \"discrete\", \"diagonalCross\", \"straightCross\", \"horizontal\", \"vertical\", \"curvedCW\", \"curvedCCW\", \"cubicBezier\"\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t/* arrows: {\r\n\t\t\t\tto: {\r\n\t\t\t\t\tenabled: true,\r\n\t\t\t\t\tscaleFactor: 0.6,\r\n\t\t\t\t\ttype: \"arrow\"\r\n\t\t\t\t},\r\n\t\t\t\t\"from\": {\r\n\t\t\t\t\tenabled: true,\r\n\t\t\t\t\tscaleFactor: 0.2,\r\n\t\t\t\t\ttype: \"circle\"\r\n\t\t\t\t},\r\n\t\t\t\t\r\n\t\t\t}, */\r\n\t\t\tarrowStrikethrough: true // default true\r\n\t\t},\r\n\t\tnodes: {\r\n\t\t\tborderWidth: 1,\r\n\t\t\tshape: \"dot\",\r\n\t\t\tcolor: \"#4CAF50\",\r\n\t\t\tsize: 10,\r\n\t\t\tfont: {\r\n\t\t\t\tsize: 12,\r\n\t\t\t\tface: \"Tahoma\"\r\n\t\t\t}\r\n\t\t},\r\n\t\tgroups: groups,\r\n\t\tlayout: {\r\n\t\t\timprovedLayout: false\r\n\t\t},\r\n\t\tinteraction: {\r\n\t\t\thideEdgesOnDrag: true,\r\n\t\t\thover: true,\r\n\t\t\ttooltipDelay: 200\r\n\t\t},\r\n\t//\tmanipulation: {},\r\n\t\tphysics: false // true false\r\n\t};\r\n\t\r\n\tvar t0, t1;\r\n\t\r\n\tfunction createWorker() {\r\n\t\tif (window.Worker) {\r\n\t\t\tg.dataConvertor = new Worker(`${WORKERS_DIR}/dataConvertor.js`);\r\n\t\t\tg.highlighter = new Worker(`${WORKERS_DIR}/highlighter.js`);\r\n\t\t\t\r\n\t\t\tg.dataConvertor.onmessage = function (e) {\r\n\t\t\t\tconsole.log(\"convert is finished.\");\r\n\t\t\t\tvar data = e.data;\r\n\t\t\t\tg.nodes.update(data.nodes);\r\n\t\t\t\tg.edges.update(data.edges);\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tg.highlighter.onmessage = function (e) {\r\n\t\t\t\tt1 = performance.now();\r\n\t\t\t\tconsole.log(\"worker is finished: \"+ (t1-t0) );\r\n\t\t\t\tvar data = e.data,\r\n\t\t\t\t\tnodes = data.nodes,\r\n\t\t\t\t\tedges = data.edges\r\n\t\t\t\t\r\n\t\t\t\tif (nodes.length) {\r\n\t\t\t\t\tg.nodes.update(data.nodes);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (edges.length) {\r\n\t\t\t\t\tg.edges.update(data.edges);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tconsole.warn(\"Your browser doesn't support web workers.\");\r\n\t\t}\r\n\t}\r\n\tfunction convertData(data) {\r\n\t\tvar oldNodes = data.nodes,\r\n\t\t\toldLinks = data.links,\r\n\t\t\tnewData = {},\r\n\t\t\tnewNodes = [],\r\n\t\t\tnewEdges = [];\r\n\t\t\r\n\t\tObject.keys(oldNodes).forEach(function (k) {\r\n\t\t\tvar node = oldNodes[k];\r\n\t\t\t\r\n\t\t\tg.nodes.add({\r\n\t\t\t\tid: node.id,\r\n\t\t\t\tlabel: node.name || node.management_ip,\r\n\t\t\t\tgroup: g.nodeTypes[node.type],\r\n\t\t\t\tx: node.x,\r\n\t\t\t\ty: node.y,\r\n\t\t\t\ttitle: tmpl.nodepopup({name: node.name, id: node.id})\r\n\t\t\t});\r\n\t\t\t\r\n\t\t});\r\n\t\tObject.keys(oldLinks).forEach(function (k) {\r\n\t\t\tvar link = oldLinks[k],\r\n\t\t\t\tsrc = link.src,\r\n\t\t\t\tdest = link.dest;\r\n\t\t\t\r\n\t\t\tg.edges.add({\r\n\t\t\t\t/* from: link.src.id,\r\n\t\t\t\tto: link.dest.id */\r\n\t\t\t\t\r\n\t\t\t\t\"from\": u.isObj(src) ? src.id : src || link.source_id,\r\n\t\t\t\tto: u.isObj(dest) ? dest.id : dest || link.destination_id,\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\tnewData.nodes = newNodes;\r\n\t\tnewData.edges = newEdges;\r\n\t\treturn newData;\r\n\t}\r\n\tfunction draw(data) {\r\n\t\t// data = convertData(data);\r\n\t\tdata.nodeTypes = g.nodeTypes;\r\n\t\tg.dataConvertor.postMessage(data);\r\n\t\t\r\n\t\t// g.nodes.update(data.nodes);\r\n\t\t// g.edges.update(data.edges);\r\n\t\t\r\n\t\t// g.network.setData({nodes: data.nodes, edges: data.edges});\r\n\t}\r\n\tfunction init(elementId) {\r\n\t\tvar width = window.innerWidth,\r\n\t\t\theight = window.innerHeight,\r\n\t\t\thW = width / 2;\r\n\t\t\thH = height / 2;\r\n\t\t\r\n\t\tg.container = $(elementId);\r\n\t\tg.container.height(window.innerHeight);\r\n\t\t\r\n\t\tg.network = new vis.Network(g.container[0], {nodes: g.nodes, edges: g.edges}, g.options);\r\n\t\tg.network.on(\"click\", workerHighlight); // workerHighlight neighbourhoodHighlight\r\n\t\twindow.network = g.network;\r\n\t\t\r\n\t\t$(window).on(\"resize\", function () {\r\n\t\t\tg.container.height(window.innerHeight);\r\n\t\t});\r\n\t\t/* $.ajax({\r\n\t\t\turl: \"http://localhost:3000\",\r\n\t\t\ttype: \"POST\",\r\n\t\t\tdataType: \"json\",\r\n\t\t\tdata: {\r\n\t\t\t\tx1: -1000,// -hW\r\n\t\t\t\tx2: 1000,// hW window.innerWidth,\r\n\t\t\t\ty1: -600, // -hH\r\n\t\t\t\ty2: 600 // hH window.innerHeight\r\n\t\t\t}\r\n\t\t})\r\n\t\t.done(function (data) {\r\n\t\t\tconsole.log(data);\r\n\t\t\tt = data;\r\n\t\t\tdraw(data);\r\n\t\t}); */\r\n\t\tcreateWorker();\r\n\t}\r\n\t\r\n\t\r\n\tvar GRAYED_OUT_COLOR = \"rgba(200, 200, 200, 0.5)\"; \"rgba(150, 150, 150, 0.75)\"\r\n\tvar active = false;\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tvar highlightActive = false;\r\n\tfunction neighbourhoodHighlight(e) {\r\n\t\tvar t0 = performance.now();\r\n\t\t\r\n\t\tvar network,\r\n\t\t\tnodes,\r\n\t\t\tedges,\r\n\t\t\tk, i, node, edge, hiddenLabel, len, originalColor,\r\n\t\t\tkeys,\r\n\t\t\ttargetId,\r\n\t\t\tconnectedNodes, connectedEdges,\r\n\t\t\to = {returnType: \"Object\"},\r\n\t\t\ttoUpdateNodes = [],\r\n\t\t\ttoUpdateEdges = [];\r\n\t\t\t\r\n\t\t\r\n\t\tnodes = g.nodes.get(o);\r\n\t\tedges = g.edges.get(o);\r\n\t\t\r\n\t\tif (e.nodes.length > 0) {\r\n\t\t\tnetwork = g.network;\r\n\t\t\thighlightActive = true;\r\n\t\t\ttargetId = e.nodes[0];\r\n\t\t\t\r\n\t\t\tkeys = Object.keys(nodes);\r\n\t\t\tlen = keys.length;\r\n\t\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\t\tnode = nodes[ keys[i] ];\r\n\t\t\t\thiddenLabel = node.hiddenLabel;\r\n\t\t\t\t\r\n\t\t\t\tnode.color = GRAYED_OUT_COLOR;\r\n\t\t\t\tif (hiddenLabel === undefined) {\r\n\t\t\t\t\tnode.hiddenLabel = node.label;\r\n\t\t\t\t\tnode.label = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconnectedNodes = network.getConnectedNodes(targetId); // array of ids\r\n\t\t\tlen = connectedNodes.length;\r\n\t\t\t\r\n\t\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\t\tnode = nodes[ connectedNodes[i] ];\r\n\t\t\t\thiddenLabel = node.hiddenLabel;\r\n\t\t\t\t\r\n\t\t\t\tnode.color = undefined;\r\n\t\t\t\tif (hiddenLabel !== undefined) {\r\n\t\t\t\t\tnode.label = hiddenLabel;\r\n\t\t\t\t\tnode.hiddenLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tnode = nodes[targetId];\r\n\t\t\thiddenLabel = node.hiddenLabel;\r\n\t\t\tnode.color = undefined;\r\n\t\t\tif (hiddenLabel !== undefined) {\r\n\t\t\t\tnode.label = hiddenLabel;\r\n\t\t\t\tnode.hiddenLabel = undefined;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tkeys = Object.keys(edges);\r\n\t\t\tlen = keys.length;\r\n\t\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\t\tedge = edges[ keys[i] ];\r\n\t\t\t\toriginalColor = edge.originalColor;\r\n\t\t\t\tif (originalColor === undefined) {\r\n\t\t\t\t\tedge.originalColor = edge.color;\r\n\t\t\t\t\tedge.color = GRAYED_OUT_COLOR;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconnectedEdges = network.getConnectedEdges(targetId); // array of ids\r\n\t\t\t\r\n\t\t\tlen = connectedEdges.length;\r\n\t\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\t\tedge = edges[ connectedEdges[i] ];\r\n\t\t\t\toriginalColor = edge.originalColor;\r\n\t\t\t\tif (originalColor !== undefined) {\r\n\t\t\t\t\tedge.color = originalColor;\r\n\t\t\t\t\tedge.originalColor = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t} else if (highlightActive === true) {\r\n\t\t\tkeys = Object.keys(nodes);\r\n\t\t\tlen = keys.length;\r\n\t\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\t\tnode = nodes[ keys[i] ];\r\n\t\t\t\thiddenLabel = node.hiddenLabel;\r\n\t\t\t\t\r\n\t\t\t\tnode.color = undefined;\r\n\t\t\t\tif (hiddenLabel !== undefined) {\r\n\t\t\t\t\tnode.label = hiddenLabel;\r\n\t\t\t\t\tnode.hiddenLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tkeys = Object.keys(edges);\r\n\t\t\tlen = keys.length;\r\n\t\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\t\tedge = edges[ keys[i] ];\r\n\t\t\t\toriginalColor = edge.originalColor;\r\n\t\t\t\tif (originalColor !== undefined) {\r\n\t\t\t\t\tedge.color = originalColor;\r\n\t\t\t\t\tedge.originalColor = undefined;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\thighlightActive = false\r\n\t\t}\r\n\t\t\r\n\t\tkeys = Object.keys(nodes);\r\n\t\tlen = keys.length;\r\n\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\ttoUpdateNodes.push( nodes[ keys[i] ] );\r\n\t\t}\r\n\t\t\r\n\t\tkeys = Object.keys(edges);\r\n\t\tlen = keys.length;\r\n\t\tfor (i=0; i<len; i+=1) {\r\n\t\t\ttoUpdateEdges.push( edges[ keys[i] ] );\r\n\t\t}\r\n\t\t\r\n\t\tvar t1 = performance.now();\r\n\t\tconsole.log(\"took \" + (t1 - t0) + \" milliseconds.\");\r\n\t\t\r\n\t\tg.nodes.update(toUpdateNodes);\r\n\t\tg.edges.update(toUpdateEdges);\r\n\t}\r\n\t\r\n\tvar highlightActive = false;\r\n\tfunction workerHighlight(e) {\r\n\t\t\r\n\t\tvar targetId = e.nodes[0];\r\n\t\tvar network = g.network;\r\n\t\tvar o = {returnType: \"Object\"};\r\n\t\tvar data = {\r\n\t\t\tlen: e.nodes.length,\r\n\t\t\ttargetId: targetId,\r\n\t\t\tnodes: g.nodes.get(o),\r\n\t\t\tedges: g.edges.get(o),\r\n\t\t\tconnectedNodes: targetId ? network.getConnectedNodes(targetId) : [],\r\n\t\t\tconnectedEdges: targetId ? network.getConnectedEdges(targetId) : []\r\n\t\t};\r\n\t\t\r\n\t\tt0 = performance.now();\r\n\t\tg.highlighter.postMessage(data);\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t\r\n\tinst.convertData = convertData;\r\n\tinst.draw = draw;\r\n\tinst.init = init;\r\n\tinst.clear = function () {\r\n\t\tg.nodes.clear();\r\n\t\tg.edges.clear();\r\n\t};\r\n\tinst.g = g;\r\n\t\r\n\twindow.visMap = g;\r\n\treturn inst;\r\n});"]}