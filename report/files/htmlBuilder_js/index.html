<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - htmlBuilder.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>htmlBuilder.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">71.65</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">317</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">39.12</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">1.97</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">const DIR = &quot;template/static&quot;;
const EXT = &quot;.handlebars&quot;;

let Handlebars = require(&quot;handlebars&quot;);
let chokidar = require(&quot;chokidar&quot;);
let watcher = chokidar.watch(`${DIR}/**/*${EXT}`, {ignored: /[\/\\]\./, persistent: true});
let colors = require(&quot;colors/safe&quot;);
let fs = require(&quot;fs&quot;);
let u = require(&quot;util-ma&quot;);
let fileOpt = {encoding: &quot;utf-8&quot;, flag: &quot;r&quot;};
let once = process.argv.indexOf(&quot;--once&quot;) !== -1;
let log = console.log;

let isObj = u.isObj,
	isStr = u.isStr,
	isUndef = u.isUndef;


function newEmpty() {
	return {
		template: undefined,
		data: {}
	};
}

let src = newEmpty();
let html = &quot;&quot;;

if (!once) {
	watcher
		.on(&quot;ready&quot;, function () {
			log( colors.blue.bold(&quot;Initial scan complete. Ready for changes.&quot;) );
		})
		.on(&quot;add&quot;, path =&gt; {
			log( colors.green.bold(&quot;File added:&quot;), path );
		})
		.on(&quot;addDir&quot;, path =&gt; {
			log( colors.black.bgGreen(&quot;Folder added: &quot;), path );
		})
		.on(&quot;unlink&quot;, path =&gt; {
			log( colors.red.bold(&quot;File removed: &quot;), path );
		})
		.on(&quot;unlinkDir&quot;, path =&gt; {
			log( colors.white.bgRed(&quot;Folder removed:&quot;), path );
		})
		.on(&quot;change&quot;, path =&gt; {
			log( colors.cyan.bold(&quot;File changed: &quot;), path );
		});
}

function readFile(path) {
	return fs.readFileSync(path, { encoding: &#039;utf-8&#039;, flag: &#039;r&#039; });
}
function getDirs(p) {
	return fs.readdirSync(p).filter( f =&gt; fs.statSync(p+&quot;/&quot;+f).isDirectory() );
}
function getFiles(p) {
	return fs.readdirSync(p).filter( f =&gt; fs.statSync(p+&quot;/&quot;+f).isFile() );
}

function getTarget(root, namespace, noTemp) {
	let o;
	if (root) {
		if (!namespace) {
			if ( isObj(root) ) {
				o = root;
			} else if ( isStr(root) ) {
				if (!src.data[root]) {
					src.data[root] = newEmpty();
				}
				o = src.data[root];
			}
		} else if (namespace) {
			if ( isObj(root) ) {
				let p = root.data[namespace];
				if ( isUndef(p) || isStr(p) ) {
					if (noTemp) {
						if ( isUndef(p) ) { root.data[namespace] = &quot;&quot;; }
						o = root.data;
					} else {
						root.data[namespace] = newEmpty();
						o = root.data[namespace];
					}
				} else {
					if ( isObj(p) ) {
						o = root.data[namespace];
					}
				}
			} else if ( isStr(root) ) {
				let p = src.data[root];
				if (!p) {
					src.data[root] = newEmpty();
				} else if (!p.data[namespace]) {
					src.data[root].data[namespace] = noTemp ? &quot;&quot; : newEmpty();
				}
				o = noTemp ? src.data[root].data : src.data[root].data[namespace];
			}
		}
	} else {
		o = src;
	}
	
	return o;
}
function addTemplate(path, root, namespace) {
	let o = getTarget(root, namespace);
	o.template = Handlebars.compile( readFile(path) );
}
function addData(filePath, fileName, root, namespace, noTemp) {
	let o = getTarget(root, namespace, noTemp);
	
	if (!noTemp) {
		o.data[fileName] = readFile(filePath);
	} else {
		if (namespace) {
			o[namespace] += readFile(filePath) ;
		} else {
			o += readFile(filePath) ;
		}
		
	}
}
function fudge(path, o, ns) {
	let root = path.endsWith(&quot;/&quot;) ? path: path+&quot;/&quot;;
	
	let files = getFiles(path);
	if (files.length) {
		files.forEach(i =&gt; {
			let fullPath = root+i;
			if ( i.endsWith(&quot;main.handlebars&quot;) ) {
				addTemplate(fullPath, o, ns);
			} else if ( i.endsWith(&quot;.htm&quot;) ) {
				let fileName = i.substr( 0, i.indexOf(&#039;.&#039;) );
				addData(fullPath, fileName, o, ns);
			}
		});
	}
	let dirs = getDirs(path);
	if (dirs.length) { // folder contains folder(s)
		dirs.forEach(i =&gt; {
			let fullPath = root+i;
			let files = getFiles(fullPath);
			if (files.length) {
				if (files.indexOf(&quot;main.handlebars&quot;) !== -1) { // folder contains main.handlebars
					fudge(fullPath, ns ? o.data[ns] : o, i);
				} else { // folder doesn&#039;t contain .handlebars
					dirHandler(fullPath, o.data[ns] || o, i);
				}
			}
		});
	}
}
function dirHandler(p, root, ns) {
	let path = p.endsWith(&quot;/&quot;) ? p : p+&quot;/&quot;;
	let files = getFiles(path);
	let dirs = getDirs(path);
	
	if (files.length) {
		files.forEach(i =&gt; {
			if ( i.endsWith(&quot;.htm&quot;) ) {
				// addData( path+i, root, i.substr( 0, i.indexOf(&#039;.&#039;) ), true );
				addData(path+i, i.substr( 0, i.indexOf(&#039;.&#039;) ), root, ns, true);
			}
		});
	}
	if (dirs.length) {
		dirs.forEach(i =&gt; {
			dirHandler(path+i, root, ns);
		});
	}
}

function buildSrc() {
	debugger
	fudge(&quot;template/static&quot;, src);
	
	console.log(src);
	
}

function compile(o) {
	Object.keys(o).forEach(k =&gt; {
		let p = o[k];
		
		if ( isObj(p) ) {
			o[k] = p.template(p.data);
		}
	});
}
function buildHtml() {
	let template = src.template;
	let data = src.data;
	
	compile(src.data);
	html = src.template(src.data);
	
}

buildSrc();
// buildHtml();

console.log(html);
/* fs.writeFile(&quot;shindex.html&quot;, text, &quot;utf8&quot;, (err) =&gt; {
	if (err) { return console.log(err); }
	log(&quot;The file was saved!&quot;);
}); */







/*

function createIndex() {
	let index = readFile(DIR+&quot;/index.handlebars&quot;);
	
	let output = &quot;&quot;;
	
	console.log( files(DIR) );
	walk(&quot;template/static/profile&quot;).forEach(i =&gt; {
		let p = i.replace(DIR, &quot;&quot;).slice(1);
		let a = p.split(&quot;/&quot;);
		
		if (p.indexOf(&quot;/&quot;) === -1) { // root folder
			src.data = {};
			if ( p.endsWith(&quot;.handlebars&quot;) ) { // template
				
				
				src.template = Handlebars.compile( readFile(i) )();
				
			} else if ( p.endsWith(&quot;.htm&quot;) ) { // data
				let fileName = p.substr( 0, p.indexOf(&#039;.&#039;) );
				src.data[fileName] = readFile(i);
				
				
			}
		} else if (p.indexOf(&quot;/&quot;) &gt;=0) { // 
			
		}
	});
	// console.log( walk(DIR) );
	
	
	
	
	
	
}


if (files.filter(v =&gt; {return /.htm/.test(v)}).length) { // at-least one .htm file

















walk(DIR).forEach(i =&gt; {
		let p = i.replace(DIR, &quot;&quot;).slice(1);
		let a = p.split(&quot;/&quot;);
		let last = a[a.length-1];
		console.log(a);
		if (last.endsWith(&quot;.handlebars&quot;)) {
			// console.log(last.replace(DIR, &quot;&quot;));
		}
	});
	// console.log( walk(DIR) );






	let source = readFile(DIR+&quot;/main&quot;+EXT);
	let a = Handlebars.compile(source);
	
	console.log(a);
	fs.writeFile(&quot;shindex.html&quot;, &quot;Hey there!&quot;, &quot;utf8&quot;, (err) =&gt; {
		if (err) { return console.log(err); }
		log(&quot;The file was saved!&quot;);
	});



let g = Handlebars.compile(src.main)();
	console.log(g);
	// getDirsIn(DIR).forEach(i =&gt; {


function walk(dir) {
	let results = []
	let list = fs.readdirSync(dir);
	list.forEach( function (file) {
		file = dir + &#039;/&#039; + file;
		let stat = fs.statSync(file);
		if ( stat &amp;&amp; stat.isDirectory() ) {
			results = results.concat( walk(file) );
		} else {
			results.push(file)
		}
	});
	return results;
};
*/</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ cyclomatic }} <br>
    Length : {{ halstead.length }} <br>
    Difficulty : {{ halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
