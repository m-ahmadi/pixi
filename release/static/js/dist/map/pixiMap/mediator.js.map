{"version":3,"sources":["../../../src/map/pixiMap/mediator.js"],"names":["define","wpix","tpl","navigation","popupManager","wuk","u","ajax","inst","p","GLOBAL_BOUNDS","X_1","X_2","Y_1","Y_2","data","bounds","width","height","counters","xLeft","xRight","yUp","yDown","movePopup","incX","incY","el","activeBox","pLeft","pTop","parseInt","css","loadData","container","abort","xhr","undefined","done","clearContainer","draw","pixiCallback","w","h","hW","hH","b","d","x1","x2","y1","y2","xL","xR","yU","yD","console","log","t","fail","a","c","note","error","panCallback","pos","x","Math","floor","y","odd","util","isNumOdd","cnt","zoomCallback","zoomIn","popup","e","addCustomEvents","on","dx","dy","zoom","pan","init","div","containerDiv","callback","panBounds","Object","defineProperties","get","renderer","clear","resize","setPosition","mainContainer"],"mappings":"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","file":"mediator.js","sourcesContent":["define(['./wpix', './tpl', './navigation', './popupManager', 'core/wuk', 'core/util', 'core/ajax'], function (wpix, tpl, navigation, popupManager, wuk, u, ajax) {\r\n\tvar inst = {},\r\n\t\tp = {};\r\n\t\r\n\tp.GLOBAL_BOUNDS = {\r\n\t\tX_1: -10000,\r\n\t\tX_2: 10000,\r\n\t\tY_1: -6000,\r\n\t\tY_2: 6000\r\n\t};\r\n\tp.data = {};    // unreversed for ajax data\r\n\tp.bounds = {};  // reversed to ease bound calculations\r\n\tp.width = 0;\r\n\tp.height = 0;\r\n\tp.counters = {\r\n\t\txLeft:  0,\r\n\t\txRight: 0,\r\n\t\tyUp:    0,\r\n\t\tyDown:  0\r\n\t};\r\n\tp.ajax;\r\n\t\r\n\tfunction movePopup(incX, incY) {\r\n\t\tvar el = popupManager.activeBox,\r\n\t\t\tpLeft, pTop;\r\n\t\t\r\n\t\tif (el) {\r\n\t\t\tif (incX) {\r\n\t\t\t\tpLeft = parseInt( el.css('left'), 10);\r\n\t\t\t\tel.css('left', pLeft += incX);\r\n\t\t\t} else if (incY) {\r\n\t\t\t\tpTop = parseInt( el.css('top'), 10);\r\n\t\t\t\tel.css('top', pTop += incY);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfunction loadData(container) {\r\n\t\tcontainer = container ? container : \"viewport\";\r\n\t\tvar abort = p.ajax ? p.ajax.xhr.abort : undefined;\r\n\t\t\r\n\t\tif (abort) {\r\n\t\t\tabort();\r\n\t\t}\r\n\t\t\r\n\t\tp.ajax = ajax({\r\n\t\t\tdata: p.data\r\n\t\t})\r\n\t\t.done(function (data) {\r\n\t\t\twpix.clearContainer(container || \"viewport\");\r\n\t\t\ttpl.draw(data, container || \"viewport\", p.bounds);\r\n\t\t});\r\n\t}\r\n\tfunction pixiCallback(width, height) {\r\n\t\tvar w = width,\r\n\t\t\th = height,\r\n\t\t\thW = w / 2,\r\n\t\t\thH = h / 2,\r\n\t\t\tb = p.bounds,\r\n\t\t\td = p.data;\r\n\t\tp.width = w;\r\n\t\tp.height = h;\r\n\t\t\r\n\t\t// p.data.x1 = -hW;\r\n\t\t// p.data.x2 = w + hW;\r\n\t\t// p.data.y1 = -hH;\r\n\t\t// p.data.y2 = h + hH;\r\n\t\t\r\n\t\td.x1 = -1000; // 0\r\n\t\td.x2 = 2000; // w\r\n\t\td.y1 = -500; // 0\r\n\t\td.y2 = 900; // h\r\n\t\t\r\n\t\t// p.bounds.x1 = hW;\r\n\t\t// p.bounds.x2 = -hW;\r\n\t\t// p.bounds.y1 = hH;\r\n\t\t// p.bounds.y2 = -hH;\r\n\t\t\r\n\t\tb.xL = hW;\r\n\t\tb.xR = -hW;\r\n\t\tb.yU = hH;\r\n\t\tb.yD = -hH;\r\n\t\t\r\n\t\tconsole.log(p.bounds);\r\n\t\tconsole.log(p.data);\r\n\t\t\r\n\t\t// dataLoader.load(p.data);\r\n\t\tvar xhr = ajax({\r\n\t\t\tdata: p.data\r\n\t\t})\r\n\t\t.done(function ( data ) { // {url: \"js/d.txt\"}\r\n\t\t\tconsole.log(data);\r\n\t\t\tt = data;\r\n\t\t\ttpl.draw(data, \"viewport\");\r\n\t\t})\r\n\t\t.fail(function (a, b, c) {\r\n\t\t\twuk.note.error('Request for initial draw has failed.')\r\n\t\t});\r\n\t}\r\n\tfunction panCallback(pos) {\r\n\t\tmovePopup(pos);\r\n\t\tvar x = Math.floor(pos.x),\r\n\t\t\ty = Math.floor(pos.y),\r\n\t\t\tb = p.bounds,\r\n\t\t\td = p.data,\r\n\t\t\tw = p.width,\r\n\t\t\th = p.height,\r\n\t\t\thW = w / 2,\r\n\t\t\thH = h / 2,\r\n\t\t\tc = p.counters,\r\n\t\t\todd = util.isNumOdd,\r\n\t\t\tcnt;\r\n\t\t/*\r\n\t\tif (x >= b.xL) { // x1 512   x 0 1 2 3 4 5 6 7 8 9 (going left)\r\n\t\t\tc.xLeft += 1;\r\n\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tb.xL += hW;\r\n\t\t\tb.xR += hW;\r\n\t\t\t\r\n\t\t\td.x1 -= hW;\r\n\t\t\td.x2 -= hW;\r\n\t\t\t\r\n\t\t\tconsole.log(\"salam\");\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tif ( odd(c.xLeft) ) { // \r\n\t\t\t\t\r\n\t\t\t\tconsole.log(\"first\");\r\n\t\t\t\tcnt = \"xSec1\";\r\n\t\t\t} else if ( !odd(c.xLeft) ) {\r\n\t\t\t\t\r\n\t\t\t\tconsole.log(\"second\");\r\n\t\t\t\tcnt = \"xSec2\";\r\n\t\t\t}\r\n\t\t\tconsole.log(b);\r\n\t\t\tconsole.log(d);\r\n\t\t\t\r\n\t\t\tloadData(cnt);\r\n\t\t}\r\n\t\t\r\n\t\tif (x <= b.xR) { // x2 -512 x -1 -2 -3 -4 -5 -6 -7 (going right)\r\n\t\t\t\r\n\t\t\tconsole.log(\"chetori\");\r\n\t\t\tb.xL -= hW;\r\n\t\t\tb.xR -= hW;\r\n\t\t\t\r\n\t\t\td.x1 += hW;\r\n\t\t\td.x2 += hW;\r\n\t\t\t\r\n\t\t\tconsole.log(b);\r\n\t\t\tconsole.log(d);\r\n\t\t\tloadData();\r\n\t\t}\r\n\t\t*/\r\n\t\t//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n\t\tif (x >= b.xL) { // going left\r\n\t\t\tb.xL += hW;\r\n\t\t\tb.xR += hW;\r\n\t\t\td.x1 -= hW;\r\n\t\t\td.x2 -= hW;\r\n\t\t\tconsole.log(\"salam\");\r\n\t\t\tconsole.log(b);\r\n\t\t\tconsole.log(d);\r\n\t\t\tloadData();\r\n\t\t}\r\n\t\tif (x <= b.xR) { // going right\r\n\t\t\tconsole.log(\"chetori\");\r\n\t\t\tb.xL -= hW;\r\n\t\t\tb.xR -= hW;\r\n\t\t\td.x1 += hW;\r\n\t\t\td.x2 += hW;\r\n\t\t\tconsole.log(b);\r\n\t\t\tconsole.log(d);\r\n\t\t\tloadData();\r\n\t\t}\r\n\t\t\r\n\t\tif (y >= b.yU) { // going up\r\n\t\t\tb.yU += hH;\r\n\t\t\tb.yD += hH;\r\n\t\t\td.y1 -= hH;\r\n\t\t\td.y2 -= hH;\r\n\t\t\tconsole.log(b);\r\n\t\t\tconsole.log(d);\r\n\t\t\tloadData();\r\n\t\t}\r\n\t\tif (y <= b.yD) { // going down\r\n\t\t\tb.yU -= hH;\r\n\t\t\tb.yD -= hH;\r\n\t\t\td.y1 += hH;\r\n\t\t\td.y2 += hH;\r\n\t\t\tconsole.log(b);\r\n\t\t\tconsole.log(d);\r\n\t\t\tloadData();\r\n\t\t}\r\n\t\t\r\n\t\t//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\r\n\t\t/*\r\n\t\tif (x >= b.x1) { // x1 512   x 0 1 2 3 4 5 6 7 8 9 (going left)\r\n\t\t\tconsole.log(\"salam\");\r\n\t\t\tb.x1 += hW;\r\n\t\t\tb.x2 -= hW;\r\n\t\t\td.x1 -= hW;\r\n\t\t\td.x2 -= hW;\r\n\t\t\tconsole.log(b);\r\n\t\t\tconsole.log(d);\r\n\t\t\tloadData();\r\n\t\t}\r\n\t\t\r\n\t\tif (x <= b.x2) { // x2 -512 x -1 -2 -3 -4 -5 -6 -7 (going right)\r\n\t\t\tconsole.log(\"chetori\");\r\n\t\t\tb.x1 -= hW;\r\n\t\t\tb.x2 += hW;\r\n\t\t\td.x1 += hW;\r\n\t\t\td.x2 += hW;\r\n\t\t\tconsole.log(b);\r\n\t\t\tconsole.log(d);\r\n\t\t\tloadData();\r\n\t\t}\r\n\t\t\r\n\t\tif (y >= b.y1) { // y1 175   y1 10 20 30 (going up)\r\n\t\t\tconsole.log(\"here\");\r\n\t\t\tb.y1 += hH;\r\n\t\t\tb.y2 += hH;\r\n\t\t\td.y1 -= hH;\r\n\t\t\td.y2 += hH;\r\n\t\t\tconsole.log(b);\r\n\t\t\tconsole.log(d);\r\n\t\t\tloadData();\r\n\t\t}\r\n\t\t\r\n\t\tif (y <= b.y2) { // y2 -175  y2 -10 -20 -30 (going down)\r\n\t\t\tconsole.log(\"kitty\");\r\n\t\t\tb.y1 -= hH;\r\n\t\t\tb.y2 -= hH;\r\n\t\t\td.y1 += hH;\r\n\t\t\td.y2 += hH;\t\t\r\n\t\t\tconsole.log(b);\r\n\t\t\tconsole.log(d);\r\n\t\t\tloadData();\r\n\t\t}\r\n\t\t*/\r\n\t\t// console.log(Math.floor(x), Math.floor(y)); \r\n\t}\r\n\tfunction zoomCallback(d) {\r\n\t\tvar pos = d.pos,\r\n\t\t\tx = pos.x,\r\n\t\t\ty = pos.y,\r\n\t\t\tb = p.bounds,\r\n\t\t\txL = b.xL,\r\n\t\t\txR = b.xR,\r\n\t\t\tyU = b.yU,\r\n\t\t\tyD = b.yD,\r\n\t\t\tw = p.width,\r\n\t\t\th = p.height,\r\n\t\t\thW = w / 2,\r\n\t\t\thH = h / 2;\r\n\t\t\r\n\t\t// incX = aX > bX ? aX-bX : bX > aX ? bX-aX : undefined;\r\n\t\t// incY = aY > bY ? aY-bY : bY > aY ? bY-aY : undefined;\r\n\t\t// debugger;\r\n\t\t\r\n\t\tif (x >= xL) {\r\n\t\t\tb.xL = x+hW;\r\n\t\t\tb.xR = x-hW;\r\n\t\t\t\r\n\t\t\tconsole.log(b);\r\n\t\t}\r\n\t\tif (x <= xR) {\r\n\t\t\t\r\n\t\t}\r\n\t\tif (y >= yU) {\r\n\t\t\t\r\n\t\t}\r\n\t\tif (y <= yD) {\r\n\t\t\t\r\n\t\t}\r\n\t\tconsole.log(d.zoomIn);\r\n\t\tconsole.log(x, y);\r\n\t\t\r\n\t}\r\n\tfunction popup(e, d) {\r\n\t\t\r\n\t}\r\n\tfunction addCustomEvents() {\r\n\t\t// wpix.on(\"pan\", panCallback);\r\n\t\t// wpix.on(\"zoom\", zoomCallback);\r\n\t\twpix.on('inboundPanX', function (dx) {\r\n\t\t\tmovePopup(dx);\r\n\t\t});\r\n\t\twpix.on('inboundPanY', function (dy) {\r\n\t\t\tmovePopup(undefined, dy);\r\n\t\t});\r\n\t\twpix.on('zoom', popup);\r\n\t\t/* wpix.on('panMouseDown', function () {\r\n\t\t\tpopupManager.hideActive();\r\n\t\t});\r\n\t\twpix.on('panMouseUp', function () {\r\n\t\t\tpopupManager.showActive();\r\n\t\t}); */\r\n\t\t\r\n\t\t\r\n\t\tnavigation.on(\"zoom\", function () {\r\n\t\t\tconsole.log(\"zoom\");\r\n\t\t\twpix.zoom();\r\n\t\t});\r\n\t\tnavigation.on(\"pan\", function () {\r\n\t\t\twpix.pan.pan(1, 1);\r\n\t\t});\r\n\t}\r\n\tfunction init(div) {\r\n\t\twpix.init({\r\n\t\t\tcontainerDiv: div,\r\n\t\t\tcallback: pixiCallback,\r\n\t\t\tpanBounds: p.GLOBAL_BOUNDS\r\n\t\t});\r\n\t\t//core.init();\r\n\t\t//navigation.init();\r\n\t\t\r\n\t\taddCustomEvents();\r\n\t}\r\n\t\r\n\tinst.data = p.data;\r\n\tinst.bounds = p.bounds;\r\n\t\r\n\t// getters\r\n\tObject.defineProperties(inst, {\r\n\t\t\"width\": {\r\n\t\t\tget: function () { return wpix.renderer.width; }\r\n\t\t},\r\n\t\t\"height\": {\r\n\t\t\tget: function () { return wpix.renderer.height;}\r\n\t\t}\r\n\t});\r\n\tinst.draw = tpl.draw;\r\n\tinst.clear = tpl.clear;\r\n\tinst.resize = function (width, height) {\r\n\t\twpix.renderer.resize(width, height);\r\n\t};\r\n\tinst.setPosition = function (x, y) {\r\n\t\twpix.mainContainer.x = x;\r\n\t\twpix.mainContainer.y = y;\r\n\t};\r\n\tinst.init = init;\r\n\t\r\n\treturn inst;\r\n\t\r\n});"]}