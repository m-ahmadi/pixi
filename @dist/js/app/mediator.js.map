{"version":3,"sources":["../../../src/js/app/mediator.js"],"names":["define","u","newPubSub","mainSocket","wuk","map","sidebar","header","traceroute","discovery","inst","extend","note","addCustomEvts","on","toggle","begin","send","JSON","stringify","toSend","data","parse","e","DEBUG","console","log","draw","o","action","newX","nodeNew","x","newY","y","updateNode","id","beforeReady","init","onReady"],"mappings":"AAAAA,OAAO,CACN,WADM,EAEN,aAFM,EAGN,iBAHM,EAIN,UAJM,EAKN,cALM,EAMN,WANM,EAON,UAPM,EAQN,cARM,EASN,sBATM,EAUN,aAVM,CAAP,EAWG,UAAUC,CAAV,EAAaC,SAAb,EAAwBC,UAAxB,EAAoCC,GAApC,EAAyCC,GAAzC,EAA8CC,OAA9C,EAAuDC,MAAvD,EAA+DC,UAA/D,EAA2EC,SAA3E,EAAsF;AACxF,KAAMC,OAAOT,EAAEU,MAAF,CAAUT,WAAV,CAAb;AACA,KAAMU,OAAOR,IAAIQ,IAAjB;;AAEA,UAASC,aAAT,GAAyB;AACxBN,SAAOO,EAAP,CAAU,cAAV,EAA0B,YAAM;AAC/BR,WAAQS,MAAR;AACA,GAFD;AAGAT,UAAQQ,EAAR,CAAW,yBAAX,EAAsC,YAAM;AAC3CN,cAAWQ,KAAX;AACA,GAFD;;AAIAV,UAAQQ,EAAR,CAAW,wBAAX,EAAqC,YAAM;AAC1CL,aAAUO,KAAV;AACA,GAFD;;AAIAP,YAAUK,EAAV,CAAa,QAAb,EAAuB,kBAAU;AAChCX,cAAWc,IAAX,CAAgBC,KAAKC,SAAL,CAAeC,MAAf,CAAhB,EAAwC,aAAK;AAC5C,QAAIC,OAAOH,KAAKI,KAAL,CAAWC,EAAEF,IAAb,CAAX;AACA,QAAIG,KAAJ,EAAW;AAAEC,aAAQC,GAAR,CAAYL,IAAZ;AAAmB;AAChChB,QAAIsB,IAAJ,CAASN,IAAT;AACA,IAJD;AAKA,GAND;AAOAhB,MAAIS,EAAJ,CAAO,uBAAP,EAAgC,mBAAW;AAC1C,OAAIc,IAAI;AACPC,YAAQ,oBADD;AAEPC,UAAMC,QAAQC,CAFP;AAGPC,UAAMF,QAAQG;AAHP,IAAR;AAKA/B,cAAWc,IAAX,CAAgBC,KAAKC,SAAL,CAAeS,CAAf,CAAhB,EAAmC,aAAK;AACvC,QAAIP,OAAOH,KAAKI,KAAL,CAAWC,EAAEF,IAAb,CAAX;AACA,IAFD;AAGAhB,OAAI8B,UAAJ,CAAe;AACdC,QAAIL,QAAQK,EADE;AAEdJ,OAAGD,QAAQC,CAFG;AAGdE,OAAGH,QAAQG;AAHG,IAAf;AAKA,GAdD;AAeA;AACD,UAASG,WAAT,GAAuB;AACtBlC,aAAWmC,IAAX,CAAgBnC,WAAWc,IAA3B,EAAiC,CAChCC,KAAKC,SAAL,CAAe,EAAC,UAAU,aAAX,EAAf,CADgC,EAEhC,aAAK;AACJ,OAAIE,OAAOH,KAAKI,KAAL,CAAWC,EAAEF,IAAb,CAAX;AACA,OAAIG,KAAJ,EAAW;AAAEC,YAAQC,GAAR,CAAYL,IAAZ;AAAmB;AAChChB,OAAIsB,IAAJ,CAASN,IAAT;AACA,GAN+B,CAAjC;AAQA;AACA;AACD,UAASkB,OAAT,GAAmB;AAClBnC,MAAIkC,IAAJ;AACAjC,MAAIiC,IAAJ,CAAS,QAAT,EAAmB,gBAAnB;AACAhC,UAAQgC,IAAR;AACA/B,SAAO+B,IAAP;AACA9B,aAAW8B,IAAX;AACA7B,YAAU6B,IAAV;AACAzB;AAIA;AACDH,MAAK2B,WAAL,GAAmBA,WAAnB;AACA3B,MAAK6B,OAAL,GAAeA,OAAf;;AAEA,QAAO7B,IAAP;AACA,CA7ED","file":"mediator.js","sourcesContent":["define([\r\n\t\"core/util\",\r\n\t\"core/pubsub\",\r\n\t\"core/mainSocket\",\r\n\t\"core/wuk\",\r\n\t\"map/mediator\",\r\n\t\"./sidebar\",\r\n\t\"./header\",\r\n\t\"./traceroute\",\r\n\t\"./discovery/mediator\",\r\n\t\"./templates\"\r\n], function (u, newPubSub, mainSocket, wuk, map, sidebar, header, traceroute, discovery) {\r\n\tconst inst = u.extend( newPubSub() );\r\n\tconst note = wuk.note;\r\n\t\r\n\tfunction addCustomEvts() {\r\n\t\theader.on(\"menu_clicked\", () => {\r\n\t\t\tsidebar.toggle();\r\n\t\t});\r\n\t\tsidebar.on(\"traceroute_item_clicked\", () => {\r\n\t\t\ttraceroute.begin();\r\n\t\t});\r\n\t\t\r\n\t\tsidebar.on(\"discovery_item_clicked\", () => {\r\n\t\t\tdiscovery.begin();\r\n\t\t});\r\n\t\t\r\n\t\tdiscovery.on(\"submit\", toSend => {\r\n\t\t\tmainSocket.send(JSON.stringify(toSend), e => {\r\n\t\t\t\tlet data = JSON.parse(e.data);\r\n\t\t\t\tif (DEBUG) { console.log(data) }\r\n\t\t\t\tmap.draw(data);\r\n\t\t\t});\r\n\t\t});\r\n\t\tmap.on(\"node_position_changed\", nodeNew => {\r\n\t\t\tlet o = {\r\n\t\t\t\taction: \"changeNodePosition\",\r\n\t\t\t\tnewX: nodeNew.x,\r\n\t\t\t\tnewY: nodeNew.y\r\n\t\t\t};\r\n\t\t\tmainSocket.send(JSON.stringify(o), e => {\r\n\t\t\t\tlet data = JSON.parse(e.data);\r\n\t\t\t});\r\n\t\t\tmap.updateNode({\r\n\t\t\t\tid: nodeNew.id,\r\n\t\t\t\tx: nodeNew.x,\r\n\t\t\t\ty: nodeNew.y\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\tfunction beforeReady() {\r\n\t\tmainSocket.init(mainSocket.send, [\r\n\t\t\tJSON.stringify({\"action\": \"getAllNodes\"}),\r\n\t\t\te => {\r\n\t\t\t\tlet data = JSON.parse(e.data);\r\n\t\t\t\tif (DEBUG) { console.log(data) }\r\n\t\t\t\tmap.draw(data);\r\n\t\t\t}\r\n\t\t]);\r\n\t\t// whb.compileAll();\r\n\t}\r\n\tfunction onReady() {\r\n\t\twuk.init();\r\n\t\tmap.init(\"visMap\", \"#map_container\");\r\n\t\tsidebar.init();\r\n\t\theader.init();\r\n\t\ttraceroute.init();\r\n\t\tdiscovery.init();\r\n\t\taddCustomEvts();\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t}\r\n\tinst.beforeReady = beforeReady;\r\n\tinst.onReady = onReady;\r\n\t\r\n\treturn inst;\r\n});"]}