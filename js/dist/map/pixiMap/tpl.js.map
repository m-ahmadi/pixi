{"version":3,"sources":["../../../src/map/pixiMap/tpl.js"],"names":["define","wpix","wani","u","popupManager","contextMenu","inst","p","nodes","links","idCounter","types","createNode","o","container","coefficient","node","type","name","id","thisLinks","x","y","boxSpriteText","setThings","management_ip","createBox","createBoxSpriteText","imgName","spriteScale","spriteTint","textContent","boxAlpha","addTplnodeCustomPositionGetters","b","s","sprite","midX","width","midY","height","Object","defineProperties","get","coPoint","left","top","right","bott","createTplNode","pixiEl","addHandlers","setHandler","e","tplLinks","removeAll","bringToFront","length","forEach","linkId","link","clear","tplNodes","nodeId","create","topLeft","start","end","src","center","dest","changePoints","el","increaseWidth","dragging","defaultWidth","isFn","addChild","fadeIn","createLink","path","toggle","srcId","destId","status","nth","curveLevel","srcdest","destsrc","create2pointLine","color","undefined","alpha","viewport","children","checkNode","checkLink","bounds","srcNode","destNode","isObj","isStr","source_id","destination_id","drawNodes","c","keys","k","drawLinks","draw","data","flush","clearContainer","window","tpl"],"mappings":"AAAAA,OAAO,CAAC,QAAD,EAAW,QAAX,EAAqB,WAArB,EAAkC,gBAAlC,EAAoD,eAApD,CAAP,EAA6E,UAAUC,IAAV,EAAgBC,IAAhB,EAAsBC,CAAtB,EAAyBC,YAAzB,EAAuCC,WAAvC,EAAoD;AAChI,KAAIC,OAAO,EAAX;AAAA,KACCC,IAAI,EADL;;AAGAA,GAAEC,KAAF,GAAU,EAAV;AACAD,GAAEE,KAAF,GAAU,EAAV;AACAF,GAAEG,SAAF,GAAc,CAAd;AACA;;;;;;AAMAH,GAAEI,KAAF,GAAU,CACT,GADS,EACJ,GADI,EACC,GADD,EACM,GADN,EACW,GADX,EAET,GAFS,EAEJ,GAFI,EAEC,GAFD,EAEM,GAFN,CAAV;;AAKA,UAASC,UAAT,CAAoBC,CAApB,EAAuBC,SAAvB,EAAkCC,WAAlC,EAA+C;AAC9CF,MAAIA,IAAIA,CAAJ,GAAQ,EAAZ;AACA,MAAIG,IAAJ,EACCC,IADD,EACOC,IADP,EACaC,EADb,EACiBC,SADjB,EAECC,CAFD,EAEIC,CAFJ,EAGCC,aAHD;;AAKA,WAASC,SAAT,GAAqB;AACpBP,UAAYJ,EAAEI,IAAF,IAAW,CAAvB;AACAE,QAAYN,EAAEM,EAAF,IAAW,eAAaZ,EAAEG,SAAF,IAAa,CAA1B,CAAvB;AACD;AACCQ,UAAYL,EAAEK,IAAF,IAAWL,EAAEY,aAAb,IAA+B,WAASlB,EAAEG,SAAF,IAAa,CAAtB,CAA3C;AACAW,OAAYR,EAAEQ,CAAd;AACAC,OAAYT,EAAES,CAAd;AACAF,eAAYP,EAAEJ,KAAF,IAAW,KAAvB;AACA;AACD,WAASiB,SAAT,GAAqB;AACpBH,mBAAgBtB,KAAK0B,mBAAL,CAAyB;AACxCN,OAAGN,cAAcM,IAAEN,YAAYM,CAA5B,GAAgCA,CADK;AAExCC,OAAGP,cAAcO,IAAEP,YAAYO,CAA5B,GAAgCA,CAFK;AAGxCM,aAASrB,EAAEI,KAAF,CAAQM,IAAR,CAH+B;AAIxCY,iBAAa,GAJ2B;AAKxCC,gBAAYb,IAL4B;AAMxCc,iBAAab,IAN2B;AAOxCc,cAAU;AAP8B,IAAzB,CAAhB;AASA;AACD,WAASC,+BAAT,GAA2C;AAC1C,OAAIC,IAAIX,aAAR;AAAA,OACCY,IAAID,EAAEE,MADP;;AAGA,YAASC,IAAT,GAAgB;AACf;AACA,WAAOH,EAAEb,CAAF,GAAOc,EAAEG,KAAF,GAAU,CAAxB;AACA;AACD,YAASC,IAAT,GAAgB;AACf;AACA,WAAOL,EAAEZ,CAAF,GAAOa,EAAEK,MAAF,GAAW,CAAzB;AACA;AACDC,UAAOC,gBAAP,CAAwB1B,IAAxB,EAA8B;AAC7B,WAAO;AACN2B,UAAK,YAAY;AAAE,aAAOT,EAAEZ,CAAT;AAAa;AAD1B,KADsB;AAI7B,YAAQ;AACPqB,UAAK,YAAY;AAAE,aAAOT,EAAEZ,CAAF,GAAMa,EAAEK,MAAf;AAAwB,MADpC,CACqC;AADrC,KAJqB;AAO7B,YAAQ;AACPG,UAAK,YAAY;AAAE,aAAOT,EAAEb,CAAT;AAAa;AADzB,KAPqB;AAU7B,aAAS;AACRsB,UAAK,YAAY;AAAE,aAAOT,EAAEb,CAAF,GAAMc,EAAEG,KAAf;AAAuB,MADlC,CACmC;AADnC,KAVoB;AAa7B;AACA,eAAa,EAAGK,KAAK,YAAY;AAAE,aAAO1C,KAAK2C,OAAL,CAAc,KAAKC,IAAnB,EAA2B,KAAKC,GAAhC,CAAP;AAAgD,MAAtE,EAdgB;AAe7B,gBAAa,EAAGH,KAAK,YAAY;AAAE,aAAO1C,KAAK2C,OAAL,CAAc,KAAKG,KAAnB,EAA2B,KAAKD,GAAhC,CAAP;AAAgD,MAAtE,EAfgB;AAgB7B,gBAAa,EAAGH,KAAK,YAAY;AAAE,aAAO1C,KAAK2C,OAAL,CAAc,KAAKC,IAAnB,EAA2B,KAAKG,IAAhC,CAAP;AAAgD,MAAtE,EAhBgB;AAiB7B,iBAAa,EAAGL,KAAK,YAAY;AAAE,aAAO1C,KAAK2C,OAAL,CAAc,KAAKG,KAAnB,EAA2B,KAAKC,IAAhC,CAAP;AAAgD,MAAtE,EAjBgB;AAkB7B,cAAa,EAAGL,KAAK,YAAY;AAAE,aAAO1C,KAAK2C,OAAL,CAAcP,MAAd,EAA2B,KAAKS,GAAhC,CAAP;AAAgD,MAAtE,EAlBgB;AAmB7B,eAAa,EAAGH,KAAK,YAAY;AAAE,aAAO1C,KAAK2C,OAAL,CAAcP,MAAd,EAA2B,KAAKW,IAAhC,CAAP;AAAgD,MAAtE,EAnBgB;AAoB7B,eAAa,EAAGL,KAAK,YAAY;AAAE,aAAO1C,KAAK2C,OAAL,CAAc,KAAKC,IAAnB,EAA2BN,MAA3B,CAAP;AAAgD,MAAtE,EApBgB;AAqB7B,gBAAa,EAAGI,KAAK,YAAY;AAAE,aAAO1C,KAAK2C,OAAL,CAAc,KAAKG,KAAnB,EAA2BR,MAA3B,CAAP;AAAgD,MAAtE,EArBgB;AAsB7B,cAAa,EAAGI,KAAK,YAAY;AAAE,aAAO1C,KAAK2C,OAAL,CAAcP,MAAd,EAA2BE,MAA3B,CAAP;AAAgD,MAAtE;AAtBgB,IAA9B;AAwBA;AACD,WAASU,aAAT,GAAyB;AACxBjC,UAAO,EAAP;AACAA,QAAKG,EAAL,GAAUA,EAAV;AACAH,QAAKE,IAAL,GAAYA,IAAZ;AACAF,QAAKP,KAAL,GAAaW,SAAb;AACAJ,QAAKkC,MAAL,GAAc3B,aAAd;AACAU;AACA;AACD,WAASkB,WAAT,GAAuB;AACtB5B,iBAAc6B,UAAd,CAAyB,WAAzB,EAAsC,UAAUC,CAAV,EAAarC,IAAb,EAAmBsC,QAAnB,EAA6B;AAClE,QAAI7C,QAAQO,KAAKP,KAAjB;;AAEAL,iBAAamD,SAAb;;AAEA,SAAKC,YAAL;;AAEA,QAAK/C,MAAMgD,MAAX,EAAoB;AACnBhD,WAAMiD,OAAN,CAAc,UAAUC,MAAV,EAAkB;AAC/B,UAAIC,OAAON,SAASK,MAAT,CAAX;AACA,UAAIC,IAAJ,EAAU;AACTA,YAAKV,MAAL,CAAYW,KAAZ;AACA;AACD,MALD;AAMA;AACD,IAfD,EAeG,CAAC7C,IAAD,EAAOT,EAAEE,KAAT,CAfH;AAgBAc,iBAAc6B,UAAd,CAAyB,SAAzB,EAAoC,UAAUC,CAAV,EAAarC,IAAb,EAAmBsC,QAAnB,EAA6BQ,QAA7B,EAAuC;AAC1E,QAAIC,SAAS/C,KAAKG,EAAlB;AAAA,QACCV,QAAQO,KAAKP,KADd;;AAGAL,iBAAa4D,MAAb,CAAoB,EAAC9C,MAAMA,IAAP,EAAaC,IAAIA,EAAjB,EAApB,EAA0CH,KAAKiD,OAA/C;;AAEA,QAAIxD,KAAJ,EAAW;AACVA,WAAMiD,OAAN,CAAc,UAAUC,MAAV,EAAkB;AAC/B,UAAIC,OAAON,SAASK,MAAT,CAAX;AAAA,UACCO,KADD;AAAA,UACQC,GADR;;AAGA,UAAIP,IAAJ,EAAU;AACT,WAAIA,KAAKQ,GAAL,KAAaL,MAAjB,EAAyB;AACxBG,gBAAQlD,KAAKqD,MAAb;AACA;;AAED,WAAIT,KAAKU,IAAL,KAAcP,MAAlB,EAA0B;AACzBI,cAAMnD,KAAKqD,MAAX;AACA;AACDT,YAAKV,MAAL,CAAYqB,YAAZ,CAAyBL,KAAzB,EAAgCC,GAAhC;AACA;AACD,MAdD;AAeA;AAED,IAxBD,EAwBG,CAACnD,IAAD,EAAOT,EAAEE,KAAT,EAAgBF,EAAEC,KAAlB,CAxBH;AAyBAe,iBAAc6B,UAAd,CAAyB,WAAzB,EAAsC,UAAUC,CAAV,EAAa;AAClD;;;;;;;;;AASA,IAVD;AAWA9B,iBAAc6B,UAAd,CAAyB,WAAzB,EAAsC,UAAUC,CAAV,EAAarC,IAAb,EAAmBsC,QAAnB,EAA6B;AAClE,QAAI7C,QAAQO,KAAKP,KAAjB;AAAA,QACC+D,KAAK,IADN;AAEA,QAAK/D,MAAMgD,MAAX,EAAoB;AACnBhD,WAAMiD,OAAN,CAAc,UAAUC,MAAV,EAAkB;AAC/B,UAAIC,OAAON,SAASK,MAAT,CAAX;AAAA,UACCT,MADD;AAAA,UACSuB,aADT;AAEA,UAAIb,IAAJ,EAAU;AACTV,gBAASU,KAAKV,MAAd;AACAuB,uBAAgBvB,OAAOuB,aAAvB;AACAvB,cAAOM,YAAP;AACA,WAAK,CAACgB,GAAGE,QAAT,EAAoB;AACnBD;AACA;AACD;AACD,MAXD;AAYA;AACD,IAjBD,EAiBG,CAACzD,IAAD,EAAOT,EAAEE,KAAT,CAjBH;AAkBAc,iBAAc6B,UAAd,CAAyB,UAAzB,EAAqC,UAAUC,CAAV,EAAarC,IAAb,EAAmBsC,QAAnB,EAA6B;AACjE,QAAI7C,QAAQO,KAAKP,KAAjB;AAAA,QACC+D,KAAK,IADN;AAEA,QAAK/D,MAAMgD,MAAX,EAAoB;AACnBhD,WAAMiD,OAAN,CAAc,UAAUC,MAAV,EAAkB;AAC/B,UAAIC,OAAON,SAASK,MAAT,CAAX;AAAA,UACCgB,YADD;AAEA,UAAIf,IAAJ,EAAU;AACTe,sBAAef,KAAKV,MAAL,CAAYyB,YAA3B;AACA,WAAKxE,EAAEyE,IAAF,CAAOD,YAAP,CAAL,EAA4B;AAC3B,YAAK,CAACH,GAAGE,QAAT,EAAoB;AACnBC;AACA;AACD;AACD;AACD,MAXD;AAYA;AACD,IAjBD,EAiBG,CAAC3D,IAAD,EAAOT,EAAEE,KAAT,CAjBH;AAkBAc,iBAAc6B,UAAd,CAAyB,SAAzB,EAAoC,UAAUC,CAAV,EAAa;AAChD;AACA,IAFD;AAGA;;AAED7B;AACAE;AACAuB;AACAE;;AAEA5C,IAAEC,KAAF,CAASW,EAAT,IAAgBH,IAAhB;;AAEAf,OAAK4E,QAAL,CAAc/D,SAAd,EAAyB,eAAzB,EAA0CE,KAAKkC,MAA/C;;AAEAhD,OAAK4E,MAAL,CAAY9D,KAAKkC,MAAjB;AAEA;AACD,KAAI6B,aAAc,YAAY;AAC7B,MAAIC,OAAO,EAAX;AAAA,MACCC,SAAS,KADV;;AAGA,WAASjB,MAAT,CAAgBE,KAAhB,EAAuBC,GAAvB,EAA4Be,KAA5B,EAAmCC,MAAnC,EAA2CxB,MAA3C,EAAmDyB,MAAnD,EAA2DtE,SAA3D,EAAsE;AACrE,OAAI8C,IAAJ,EAAUV,MAAV,EAAkBmC,GAAlB,EAAuBC,UAAvB,EACCC,OADD,EACUC,OADV;;AAGAD,aAAUL,QAAQC,MAAlB;AACAK,aAAUL,SAASD,KAAnB;AACAtB,UAAU,EAAV;;AAEA,OAAK,CAACoB,KAAKO,OAAL,CAAD,IAAkB,CAACP,KAAKQ,OAAL,CAAxB,EAAwC;AACvCR,SAAKO,OAAL,IAAgB,CAAhB;AACA,IAFD,MAEO,IAAKP,KAAKO,OAAL,CAAL,EAAqB;AAC3BP,SAAKO,OAAL,KAAiB,CAAjB;AACA,IAFM,MAEA,IAAKP,KAAKQ,OAAL,CAAL,EAAqB;AAC3BR,SAAKQ,OAAL,KAAiB,CAAjB;AACA;;AAEDH,SAAML,KAAKO,OAAL,KAAiBP,KAAKQ,OAAL,CAAvB;AACAF,gBAAa,CAACD,MAAI,CAAL,IAAQ,CAArB;;AAEA;AACA;;AAEAnC,YAASjD,KAAKwF,gBAAL,CAAsB;AAC9BvB,WAAOA,KADuB;AAE9BC,SAAKA,GAFyB;AAG9BuB,WAAQN,WAAW,CAAX,GAAe,QAAf,GAA0B;AAChCA,eAAW,CAAX,GAAe,QAAf,GAA0B;AAC1BA,eAAW,CAAX,GAAe,QAAf,GAA0B;AAC1BA,eAAW,CAAX,GAAe,QAAf,GAA0B;AAC1BA,eAAW,CAAX,GAAe,QAAf,GAA0B;AAC1BA,eAAW,CAAX,GAAe,QAAf,GAA0BO,SARE,EAQS;AACvCC,WAAO;AATuB,IAAtB,CAAT;;AAYA1C,UAAOE,UAAP,CAAkB,WAAlB,EAA+B,YAAY;AAC1C;AACA,SAAKI,YAAL,CAAmBvD,KAAK4F,QAAL,CAAcC,QAAd,CAAuB,CAAvB,EAA0BA,QAA7C;AACA,IAHD;;AAKAlC,QAAKV,MAAL,GAAcA,MAAd;AACAU,QAAKzC,EAAL,GAAUwC,MAAV;AACAC,QAAKQ,GAAL,GAAWc,KAAX;AACAtB,QAAKU,IAAL,GAAYa,MAAZ;;AAEA5E,KAAEE,KAAF,CAASkD,MAAT,IAAoBC,IAApB;;AAGA3D,QAAK4E,QAAL,CAAc/D,SAAd,EAAyB,eAAzB,EAA0C8C,KAAKV,MAA/C;;AAEAhD,QAAK4E,MAAL,CAAY5B,MAAZ;AACA;;AAED,SAAOc,MAAP;AACA,EAzDiB,EAAlB;;AA2DA,UAAS+B,SAAT,CAAmB/E,IAAnB,EAAyBF,SAAzB,EAAoC;AACnCF,aAAYI,IAAZ,EAAkBF,SAAlB;AACA;AACD,UAASkF,SAAT,CAAmBpC,IAAnB,EAAyB9C,SAAzB,EAAoCmF,MAApC,EAA4C;AAC3C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqCA;;AAEA,MAAIf,KAAJ;AAAA,MAAWC,MAAX;AAAA,MAAmBe,OAAnB;AAAA,MAA4BC,QAA5B;AAAA,MAAsCxC,MAAtC;AAAA,MACCyC,QAAQjG,EAAEiG,KADX;AAAA,MAECC,QAAQlG,EAAEkG,KAFX;;AAIA,MAAIzC,KAAKQ,GAAT,EAAc;AACb,OAAKgC,MAAMxC,KAAKQ,GAAX,CAAL,EAAuB;AACtBc,YAAQtB,KAAKQ,GAAL,CAASjD,EAAjB;AAEA,IAHD,MAGO,IAAKkF,MAAMzC,KAAKQ,GAAX,CAAL,EAAuB;AAC7Bc,YAAQtB,KAAKQ,GAAb;AACA;AACD,GAPD,MAOO,IAAIR,KAAK0C,SAAT,EAAoB;AAC1BpB,WAAQtB,KAAK0C,SAAb;AACA;;AAED,MAAI1C,KAAKU,IAAT,EAAe;AACd,OAAK8B,MAAMxC,KAAKU,IAAX,CAAL,EAAwB;AACvBa,aAASvB,KAAKU,IAAL,CAAUnD,EAAnB;AACA,IAFD,MAEO,IAAKkF,MAAMzC,KAAKU,IAAX,CAAL,EAAwB;AAC9Ba,aAASvB,KAAKU,IAAd;AACA;AACD,GAND,MAMO,IAAIV,KAAK2C,cAAT,EAAyB;AAC/BpB,YAASvB,KAAK2C,cAAd;AACA;AACD;AACAL,YAAU3F,EAAEC,KAAF,CAAQ0E,KAAR,CAAV;AACAiB,aAAW5F,EAAEC,KAAF,CAAQ2E,MAAR,CAAX;AACA;AACAJ,aACCmB,QAAQ7B,MADT,EAEC8B,SAAS9B,MAFV,EAGCa,KAHD,EAICC,MAJD,EAKCvB,KAAKzC,EALN,EAMCyC,KAAKwB,MANN,EAOCtE,SAPD;AASA;AACD,UAAS0F,SAAT,CAAmBhG,KAAnB,EAA0BiG,CAA1B,EAA6B1F,WAA7B,EAA0C;AACzC0B,SAAOiE,IAAP,CAAYlG,KAAZ,EAAmBkD,OAAnB,CAA2B,UAAUiD,CAAV,EAAa;AACvC;AACA/F,cAAYJ,MAAMmG,CAAN,CAAZ,EAAsBF,CAAtB,EAAyB1F,WAAzB;AACA,GAHD;AAIA;AACD,UAAS6F,SAAT,CAAmBnG,KAAnB,EAA0BgG,CAA1B,EAA6BvE,CAA7B,EAAgC;AAC/BO,SAAOiE,IAAP,CAAYjG,KAAZ,EAAmBiD,OAAnB,CAA2B,UAAUiD,CAAV,EAAa;AACvCX,aAAWvF,MAAMkG,CAAN,CAAX,EAAqBF,CAArB,EAAwBvE,CAAxB;AACA,GAFD;AAGA;AACD,UAAS2E,IAAT,CAAcC,IAAd,EAAoBhG,SAApB,EAA+BmF,MAA/B,EAAuClF,WAAvC,EAAoDgG,KAApD,EAA2D;AAC1DjG,cAAYA,YAAYA,SAAZ,GAAwB,UAApC;AACAmF,WAASA,SAASA,MAAT,GAAkB,EAA3B;AACAlF,gBAAcA,cAAcA,WAAd,GAA4B,KAA1C;;AAEA,MAAIgG,KAAJ,EAAW;AACVlD;AACA;;AAED2C,YAAUM,KAAKtG,KAAf,EAAsBM,SAAtB,EAAiCC,WAAjC;AACA6F,YAAUE,KAAKrG,KAAf,EAAsBK,SAAtB,EAAiCmF,MAAjC;AACA;AACD,UAASpC,KAAT,GAAiB;AAChB5D,OAAK+G,cAAL,CAAoB,UAApB;AACAzG,IAAEC,KAAF,GAAU,EAAV;AACAD,IAAEE,KAAF,GAAU,EAAV;AACA;;AAEDgC,QAAOC,gBAAP,CAAwBpC,IAAxB,EAA8B;AAC7B,WAAS;AACRqC,QAAK,YAAY;AAAE,WAAOpC,EAAEC,KAAT;AAAiB;AAD5B,GADoB;AAI7B,WAAS;AACRmC,QAAK,YAAY;AAAE,WAAOpC,EAAEE,KAAT;AAAiB;AAD5B;AAJoB,EAA9B;AAQAH,MAAK0F,SAAL,GAAiBA,SAAjB;AACA1F,MAAKuG,IAAL,GAAYA,IAAZ;AACAvG,MAAKuD,KAAL,GAAaA,KAAb;;AAEAoD,QAAOC,GAAP,GAAa5G,IAAb;AACA,QAAOA,IAAP;AACA,CA3XD","file":"tpl.js","sourcesContent":["define(['./wpix', './wani', 'core/util', './popupManager', './contextMenu'], function (wpix, wani, u, popupManager, contextMenu) {\r\n\tvar inst = {},\r\n\t\tp = {};\r\n\t\r\n\tp.nodes = {};\r\n\tp.links = {};\r\n\tp.idCounter = 0;\r\n\t/* p.types = [\r\n\t\t\"tv-screen\", \"macintosh\", \"imac-blue\", \"smart-tv\", \"imac-red\",\r\n\t\t\"imac-grey\", \"monitor\", \"ipad\", \"iphone\", \"macbook\",\r\n\t\t\"computer\", \"gamepad\", \"playstation\", \"hard-drive\",\r\n\t\t\"smartphone\", \"smartwatch\", \"video-card\", \"xbox\"\r\n\t]; */\r\n\tp.types = [\r\n\t\t\"1\", \"2\", \"3\", \"4\", \"5\",\r\n\t\t\"6\", \"7\", \"8\", \"9\"\r\n\t];\r\n\t\r\n\tfunction createNode(o, container, coefficient) {\r\n\t\to = o ? o : {};\r\n\t\tvar node,\r\n\t\t\ttype, name, id, thisLinks,\r\n\t\t\tx, y,\r\n\t\t\tboxSpriteText;\r\n\t\t\r\n\t\tfunction setThings() {\r\n\t\t\ttype      = o.type  || 0;\r\n\t\t\tid        = o.id    || \"tpl_node_\"+(p.idCounter+=1);\r\n\t\t//\tname      = o.name  || \"Node \"+(p.idCounter+=1);\r\n\t\t\tname      = o.name  || o.management_ip  || \"Node \"+(p.idCounter+=1);\r\n\t\t\tx         = o.x;\r\n\t\t\ty         = o.y;\r\n\t\t\tthisLinks = o.links || false;\r\n\t\t}\r\n\t\tfunction createBox() {\r\n\t\t\tboxSpriteText = wpix.createBoxSpriteText({\r\n\t\t\t\tx: coefficient ? x*coefficient.x : x,\r\n\t\t\t\ty: coefficient ? y*coefficient.y : y,\r\n\t\t\t\timgName: p.types[type],\r\n\t\t\t\tspriteScale: 0.5,\r\n\t\t\t\tspriteTint: type,\r\n\t\t\t\ttextContent: name,\r\n\t\t\t\tboxAlpha: 0\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction addTplnodeCustomPositionGetters() {\r\n\t\t\tvar b = boxSpriteText,\r\n\t\t\t\ts = b.sprite;\r\n\t\t\t\r\n\t\t\tfunction midX() {\r\n\t\t\t\t// return b.x + (b.width / 2);\r\n\t\t\t\treturn b.x + (s.width / 2);\r\n\t\t\t}\r\n\t\t\tfunction midY() {\r\n\t\t\t\t// return b.y + (b.height / 2);\r\n\t\t\t\treturn b.y + (s.height / 2);\r\n\t\t\t}\r\n\t\t\tObject.defineProperties(node, {\r\n\t\t\t\t\"top\": {\r\n\t\t\t\t\tget: function () { return b.y; }\r\n\t\t\t\t},\r\n\t\t\t\t\"bott\": {\r\n\t\t\t\t\tget: function () { return b.y + s.height; } // b.height\r\n\t\t\t\t},\r\n\t\t\t\t\"left\": {\r\n\t\t\t\t\tget: function () { return b.x; }\r\n\t\t\t\t},\r\n\t\t\t\t\"right\": {\r\n\t\t\t\t\tget: function () { return b.x + s.width; } // b.width\r\n\t\t\t\t},\r\n\t\t\t\t//--------------------------------------------------------\r\n\t\t\t\t\"topLeft\"  : {  get: function () { return wpix.coPoint( this.left  , this.top  ); }  },\r\n\t\t\t\t\"topRight\" : {  get: function () { return wpix.coPoint( this.right , this.top  ); }  },\r\n\t\t\t\t\"bottLeft\" : {  get: function () { return wpix.coPoint( this.left  , this.bott ); }  },\r\n\t\t\t\t\"bottRight\": {  get: function () { return wpix.coPoint( this.right , this.bott ); }  },\r\n\t\t\t\t\"topMid\"   : {  get: function () { return wpix.coPoint( midX()     , this.top  ); }  },\r\n\t\t\t\t\"bottMid\"  : {  get: function () { return wpix.coPoint( midX()     , this.bott ); }  },\r\n\t\t\t\t\"leftMid\"  : {  get: function () { return wpix.coPoint( this.left  , midY()    ); }  },\r\n\t\t\t\t\"rightMid\" : {  get: function () { return wpix.coPoint( this.right , midY()    ); }  },\r\n\t\t\t\t\"center\"   : {  get: function () { return wpix.coPoint( midX()     , midY()    ); }  }\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction createTplNode() {\r\n\t\t\tnode = {};\r\n\t\t\tnode.id = id;\r\n\t\t\tnode.name = name;\r\n\t\t\tnode.links = thisLinks;\r\n\t\t\tnode.pixiEl = boxSpriteText;\r\n\t\t\taddTplnodeCustomPositionGetters();\r\n\t\t}\r\n\t\tfunction addHandlers() {\r\n\t\t\tboxSpriteText.setHandler('mousedown', function (e, node, tplLinks) {\r\n\t\t\t\tvar links = node.links;\r\n\t\t\t\t\r\n\t\t\t\tpopupManager.removeAll();\r\n\t\t\t\t\r\n\t\t\t\tthis.bringToFront();\r\n\t\t\t\t\r\n\t\t\t\tif ( links.length ) {\r\n\t\t\t\t\tlinks.forEach(function (linkId) {\r\n\t\t\t\t\t\tvar link = tplLinks[linkId];\r\n\t\t\t\t\t\tif (link) {\r\n\t\t\t\t\t\t\tlink.pixiEl.clear();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, [node, p.links]);\r\n\t\t\tboxSpriteText.setHandler('mouseup', function (e, node, tplLinks, tplNodes) {\r\n\t\t\t\tvar nodeId = node.id,\r\n\t\t\t\t\tlinks = node.links;\r\n\t\t\t\t\r\n\t\t\t\tpopupManager.create({name: name, id: id}, node.topLeft);\r\n\t\t\t\t\r\n\t\t\t\tif (links) {\r\n\t\t\t\t\tlinks.forEach(function (linkId) {\r\n\t\t\t\t\t\tvar link = tplLinks[linkId],\r\n\t\t\t\t\t\t\tstart, end;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (link) {\r\n\t\t\t\t\t\t\tif (link.src === nodeId) {\r\n\t\t\t\t\t\t\t\tstart = node.center;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (link.dest === nodeId) {\r\n\t\t\t\t\t\t\t\tend = node.center;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlink.pixiEl.changePoints(start, end);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}, [node, p.links, p.nodes]);\r\n\t\t\tboxSpriteText.setHandler('mousemove', function (e) {\r\n\t\t\t\t/* var pos = e.data.global,\r\n\t\t\t\t\tbubble = popupManager.activeBox,\r\n\t\t\t\t\tpTop = bubble ? parseInt( bubble.css('top'), 10) : undefined,\r\n\t\t\t\t\tpLeft = bubble ? parseInt( bubble.css('left'), 10) : undefined;\r\n\t\t\t\t\t\r\n\t\t\t\tif (bubble) {\r\n\t\t\t\t\tbubble.css('left', (pos.x - 40)+'px');\r\n\t\t\t\t\tbubble.css('top', (pos.y - (bubble.height() + 40)) +'px');\r\n\t\t\t\t} */\r\n\t\t\t});\r\n\t\t\tboxSpriteText.setHandler('mouseover', function (e, node, tplLinks) {\r\n\t\t\t\tvar links = node.links,\r\n\t\t\t\t\tel = this;\r\n\t\t\t\tif ( links.length ) {\r\n\t\t\t\t\tlinks.forEach(function (linkId) {\r\n\t\t\t\t\t\tvar link = tplLinks[linkId],\r\n\t\t\t\t\t\t\tpixiEl, increaseWidth;\r\n\t\t\t\t\t\tif (link) {\r\n\t\t\t\t\t\t\tpixiEl = link.pixiEl;\r\n\t\t\t\t\t\t\tincreaseWidth = pixiEl.increaseWidth;\t\r\n\t\t\t\t\t\t\tpixiEl.bringToFront();\r\n\t\t\t\t\t\t\tif ( !el.dragging ) {\r\n\t\t\t\t\t\t\t\tincreaseWidth();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, [node, p.links]);\r\n\t\t\tboxSpriteText.setHandler('mouseout', function (e, node, tplLinks) {\r\n\t\t\t\tvar links = node.links,\r\n\t\t\t\t\tel = this;\r\n\t\t\t\tif ( links.length ) {\r\n\t\t\t\t\tlinks.forEach(function (linkId) {\r\n\t\t\t\t\t\tvar link = tplLinks[linkId],\r\n\t\t\t\t\t\t\tdefaultWidth;\r\n\t\t\t\t\t\tif (link) {\r\n\t\t\t\t\t\t\tdefaultWidth = link.pixiEl.defaultWidth;\r\n\t\t\t\t\t\t\tif ( u.isFn(defaultWidth) ) {\r\n\t\t\t\t\t\t\t\tif ( !el.dragging ) {\r\n\t\t\t\t\t\t\t\t\tdefaultWidth();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}, [node, p.links]);\r\n\t\t\tboxSpriteText.setHandler('rightup', function (e) {\r\n\t\t\t\t// contextMenu.show(e.data.global, 'node');\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tsetThings();\r\n\t\tcreateBox();\r\n\t\tcreateTplNode();\r\n\t\taddHandlers();\r\n\t\t\r\n\t\tp.nodes[ id ] = node;\r\n\t\t\r\n\t\twpix.addChild(container, \"nodeContainer\", node.pixiEl);\r\n\t\t\r\n\t\twani.fadeIn(node.pixiEl);\r\n\t\t\r\n\t}\r\n\tvar createLink = (function () {\r\n\t\tvar path = {},\r\n\t\t\ttoggle = false;\r\n\t\t\r\n\t\tfunction create(start, end, srcId, destId, linkId, status, container) {\r\n\t\t\tvar link, pixiEl, nth, curveLevel,\r\n\t\t\t\tsrcdest, destsrc;\r\n\t\t\t\r\n\t\t\tsrcdest = srcId + destId;\r\n\t\t\tdestsrc = destId + srcId;\r\n\t\t\tlink    = {};\r\n\t\t\t\r\n\t\t\tif ( !path[srcdest] && !path[destsrc] ) {\r\n\t\t\t\tpath[srcdest] = 1;\r\n\t\t\t} else if ( path[srcdest] ) {\r\n\t\t\t\tpath[srcdest] += 1;\r\n\t\t\t} else if ( path[destsrc] ) {\r\n\t\t\t\tpath[destsrc] += 1;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tnth = path[srcdest] || path[destsrc];\r\n\t\t\tcurveLevel = (nth-1)*2;\r\n\t\t\t\r\n\t\t\t// nth === 1  one link\r\n\t\t\t// nth > 1    more than one link\r\n\t\t\t\r\n\t\t\tpixiEl = wpix.create2pointLine({\r\n\t\t\t\tstart: start,\r\n\t\t\t\tend: end,\r\n\t\t\t\tcolor:  status === 0 ? 0x33691e : // green\r\n\t\t\t\t\t\tstatus === 1 ? 0x00695c : // cyan\r\n\t\t\t\t\t\tstatus === 2 ? 0xffd600 : // yellow\r\n\t\t\t\t\t\tstatus === 3 ? 0xe65100 : // orange\r\n\t\t\t\t\t\tstatus === 4 ? 0xff1744 : // pink\r\n\t\t\t\t\t\tstatus === 5 ? 0xb71c1c : undefined, // red\r\n\t\t\t\talpha: 0\r\n\t\t\t});\r\n\t\t\t\t\r\n\t\t\tpixiEl.setHandler('mousedown', function () {\r\n\t\t\t\t//                      viewport.lineContainer\r\n\t\t\t\tthis.bringToFront( wpix.viewport.children[0].children );\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tlink.pixiEl = pixiEl;\r\n\t\t\tlink.id = linkId;\r\n\t\t\tlink.src = srcId;\r\n\t\t\tlink.dest = destId;\r\n\t\t\t\r\n\t\t\tp.links[ linkId ] = link;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\twpix.addChild(container, \"lineContainer\", link.pixiEl);\r\n\t\t\t\r\n\t\t\twani.fadeIn(pixiEl);\r\n\t\t}\r\n\t\t\r\n\t\treturn create;\r\n\t}());\r\n\t\r\n\tfunction checkNode(node, container) {\r\n\t\tcreateNode( node, container );\r\n\t}\r\n\tfunction checkLink(link, container, bounds) {\r\n\t\t/*\r\n\t\tvar src = link.src,\r\n\t\t\tdest = link.dest,\r\n\t\t\tb = bounds ? bounds : {},\r\n\t\t\tx1 = b.x1,\r\n\t\t\tx2 = b.x2,\r\n\t\t\ty1 = b.y1,\r\n\t\t\ty2 = b.y2,\r\n\t\t\tstart, end,\r\n\t\t\tsrcOut = false,\r\n\t\t\tdestOut = false,\r\n\t\t\tnodes = p.nodes;\r\n\t\t\r\n\t\tif ( src.x > x1 &&\r\n\t\t\t\tsrc.x < x2 &&\r\n\t\t\t\tsrc.y > y1 &&\r\n\t\t\t\tsrc.y < y2 ) {\r\n\t\t\tstart = nodes[src.id].center;\r\n\t\t} else {\r\n\t\t\tsrcOut = true;\r\n\t\t}\r\n\t\t\r\n\t\tif ( dest.x > x1 &&\r\n\t\t\t\tdest.x < x2 &&\r\n\t\t\t\tdest.y > y1 &&\r\n\t\t\t\tdest.y < y2 ) {\r\n\t\t\tend = nodes[dest.id].center;\r\n\t\t} else {\r\n\t\t\tdestOut = true;\r\n\t\t}\r\n\t\t\r\n\t\tif (srcOut) {\r\n\t\t\tstart = calc();\r\n\t\t} else if (destOut) {\r\n\t\t\tend = calc();\r\n\t\t}\r\n\t\t*/\r\n\t\t// createLink(start, end, src.id, dest.id, link.id, container);\r\n\t\t\r\n\t\tvar srcId, destId, srcNode, destNode, linkId,\r\n\t\t\tisObj = u.isObj,\r\n\t\t\tisStr = u.isStr;\r\n\t\t\r\n\t\tif (link.src) {\r\n\t\t\tif ( isObj(link.src) ) {\r\n\t\t\t\tsrcId = link.src.id;\r\n\t\t\t\t\r\n\t\t\t} else if ( isStr(link.src) ) {\r\n\t\t\t\tsrcId = link.src;\r\n\t\t\t}\r\n\t\t} else if (link.source_id) {\r\n\t\t\tsrcId = link.source_id;\r\n\t\t}\r\n\t\t\r\n\t\tif (link.dest) {\r\n\t\t\tif ( isObj(link.dest) ) {\r\n\t\t\t\tdestId = link.dest.id;\r\n\t\t\t} else if ( isStr(link.dest) ) {\r\n\t\t\t\tdestId = link.dest;\r\n\t\t\t}\r\n\t\t} else if (link.destination_id) {\r\n\t\t\tdestId = link.destination_id;\r\n\t\t}\r\n\t\t//debugger;\r\n\t\tsrcNode = p.nodes[srcId];\r\n\t\tdestNode = p.nodes[destId];\r\n\t\t//debugger;\r\n\t\tcreateLink(\r\n\t\t\tsrcNode.center,\r\n\t\t\tdestNode.center,\r\n\t\t\tsrcId,\r\n\t\t\tdestId,\r\n\t\t\tlink.id,\r\n\t\t\tlink.status,\r\n\t\t\tcontainer\r\n\t\t);\r\n\t}\r\n\tfunction drawNodes(nodes, c, coefficient) {\r\n\t\tObject.keys(nodes).forEach(function (k) {\r\n\t\t\t// checkNode( nodes[k], c );\r\n\t\t\tcreateNode( nodes[k], c, coefficient );\r\n\t\t});\r\n\t}\r\n\tfunction drawLinks(links, c, b) {\r\n\t\tObject.keys(links).forEach(function (k) {\r\n\t\t\tcheckLink( links[k], c, b );\r\n\t\t});\r\n\t}\r\n\tfunction draw(data, container, bounds, coefficient, flush) {\r\n\t\tcontainer = container ? container : \"viewport\";\r\n\t\tbounds = bounds ? bounds : {};\r\n\t\tcoefficient = coefficient ? coefficient : false;\r\n\t\t\r\n\t\tif (flush) {\r\n\t\t\tclear();\r\n\t\t}\r\n\t\t\r\n\t\tdrawNodes(data.nodes, container, coefficient);\r\n\t\tdrawLinks(data.links, container, bounds);\r\n\t}\r\n\tfunction clear() {\r\n\t\twpix.clearContainer(\"viewport\");\r\n\t\tp.nodes = {};\r\n\t\tp.links = {};\r\n\t}\r\n\t\r\n\tObject.defineProperties(inst, {\r\n\t\t\"nodes\": {\r\n\t\t\tget: function () { return p.nodes; }\r\n\t\t},\r\n\t\t\"links\": {\r\n\t\t\tget: function () { return p.links; }\r\n\t\t}\r\n\t});\r\n\tinst.checkLink = checkLink;\r\n\tinst.draw = draw;\r\n\tinst.clear = clear;\r\n\t\r\n\twindow.tpl = inst;\r\n\treturn inst;\r\n});"]}