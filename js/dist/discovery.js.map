{"version":3,"sources":["../src/discovery.js"],"names":["define","map","wuk","inst","ws","path","window","location","host","coefficient","isValidIp","v","rgx","ip","ip1","test","closeModal","u","closeSidebar","sb","$","is","toggle","discover","first","second","opt","d","StartRange","EndRange","IP","Subnet","WebSocket","onopen","e","console","log","send","JSON","stringify","onmessage","data","parse","x","width","y","height","draw","undefined","onerror","onclose"],"mappings":"AAAAA,OAAO,CAAC,cAAD,EAAiB,UAAjB,CAAP,EAAqC,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAAE;AAC1D,KAAIC,OAAO,EAAX;AAAA,KACCC,EADD;AAAA,KAECC,OAAO,UAASC,OAAOC,QAAP,CAAgBC,IAAzB,GAA+B,oBAFvC;AAAA,KAGCC,cAAc,EAHf;;AAKA,UAASC,SAAT,CAAmBC,CAAnB,EAAsB;AACrB,MAAIC,MAAM;AACTC,OAAI,6FADK,EAC0F;AACnGC,QAAK,qFAFI,CAE0F;AAF1F,GAAV;;AAKA,SAAOF,IAAIC,EAAJ,CAAOE,IAAP,CAAYJ,CAAZ,CAAP;AACA;AACD,UAASK,UAAT,GAAsB;AACrB,MAAIC,CAAJ;AACA;AACA;;AAEA;;;;AAIAf,MAAIc,UAAJ,CAAe,kBAAf;AACA;AACD,UAASE,YAAT,GAAwB;AACvB,MAAIC,KAAKC,EAAE,UAAF,CAAT;;AAEA,MAAKD,GAAGE,EAAH,CAAM,UAAN,CAAL,EAAyB;AACxBF,MAAGG,MAAH,CAAU,OAAV;AACA;AACD;AACD,UAASC,QAAT,CAAkBC,KAAlB,EAAyBC,MAAzB,EAAiCC,GAAjC,EAAsC;AACrC,MAAIC,IAAI;AACNC,eAAY,EADN;AAENC,aAAU,EAFJ;AAGNC,OAAI,EAHE;AAINC,WAAQ;AAJF,GAAR;;AAOA,MAAI,CAACL,GAAL,EAAU;AAAE;AACXC,KAAEC,UAAF,GAAeJ,KAAf;AACAG,KAAEE,QAAF,GAAaJ,MAAb;AACA,GAHD,MAGO;AAAE;AACRE,KAAEG,EAAF,GAAON,KAAP;AACAG,KAAEI,MAAF,GAAWN,MAAX;AACA;;AAEDpB,UAAQqB,MAAM,SAAN,GAAiB,SAAzB;;AAEAtB,OAAK,IAAI4B,SAAJ,CAAc3B,IAAd,CAAL;;AAEAD,KAAG6B,MAAH,GAAY,UAASC,CAAT,EAAY;AACvBC,WAAQC,GAAR,CAAY,oBAAZ,EAAkCF,CAAlC;AACA9B,MAAGiC,IAAH,CAASC,KAAKC,SAAL,CAAeZ,CAAf,CAAT;AACA,GAHD;AAIAvB,KAAGoC,SAAH,GAAe,UAASN,CAAT,EAAY;AAC1B,OAAIO,OAAOP,EAAEO,IAAb;;AAEAzB;AACAE;AACA,OAAG,OAAOgB,EAAEO,IAAT,KAAkB,QAArB,EAA8B;AAC7BN,YAAQC,GAAR,CAAY,yBAAZ,EAAuCF,CAAvC,EAA0CA,EAAEO,IAA5C;;AAEAA,WAAOH,KAAKI,KAAL,CAAWD,IAAX,CAAP;AACAhC,kBAAc;AACbkC,QAAG1C,IAAI2C,KAAJ,IAAa,MAAM,EAAnB,CADU,EACc;AAC3BC,QAAG5C,IAAI6C,MAAJ,IAAc,MAAM,EAApB,CAFU,CAEc;AAFd,KAAd;AAID;AACC7C,QAAI8C,IAAJ,CAASN,IAAT,EAAe,UAAf,EAA2BO,SAA3B,EAAsCvC,WAAtC;AAEA,IAXD,MAWO;AACN0B,YAAQC,GAAR,CAAY,wBAAZ,EAAsCF,CAAtC,EAAyCA,EAAEO,IAA3C;AACA;AACD,GAnBD;AAoBArC,KAAG6C,OAAH,GAAa,UAASf,CAAT,EAAY;AACxBC,WAAQC,GAAR,CAAY,mBAAZ,EAAkCF,CAAlC;AACA,GAFD;AAGA9B,KAAG8C,OAAH,GAAa,UAAShB,CAAT,EAAY;AACxBlB;AACAE;AACAiB,WAAQC,GAAR,CAAY,mBAAZ,EAAiCF,CAAjC;AACA,GAJD;AAKA;;AAED/B,MAAKO,SAAL,GAAiBA,SAAjB;AACAP,MAAKoB,QAAL,GAAgBA,QAAhB;;AAEA,QAAOpB,IAAP;AACA,CA1FD","file":"discovery.js","sourcesContent":["define(['map/mediator', 'core/wuk'], function (map, wuk) { // 'wpix', 'tpl' wpix, tpl\r\n\tvar inst = {},\r\n\t\tws,\r\n\t\tpath = 'ws://'+ window.location.host +'/network/discovery',\r\n\t\tcoefficient = {};\r\n\t\r\n\tfunction isValidIp(v) {\r\n\t\tvar rgx = {\r\n\t\t\tip: /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/, // regex cookbook\r\n\t\t\tip1: /^(([1-9]?\\d|1\\d\\d|2[0-5][0-5]|2[0-4]\\d)\\.){3}([1-9]?\\d|1\\d\\d|2[0-5][0-5]|2[0-4]\\d)$/         // stackoverflow\r\n\t\t};\r\n\t\t\r\n\t\treturn rgx.ip.test(v);\r\n\t}\r\n\tfunction closeModal() {\r\n\t\tvar u;\r\n\t\t// $('#newSide').toggle('slide');\r\n\t\t// $(\"body\").trigger( $.Event(\"keydown\", { keyCode: 27 }) );\r\n\t\t\r\n\t\t/* u = UIkit.modal('#modal_discovery')[0];\r\n\t\tif ( u.isActive() ) {\r\n\t\t\tu.close();\r\n\t\t} */\r\n\t\twuk.closeModal(\"#modal_discovery\");\r\n\t}\r\n\tfunction closeSidebar() {\r\n\t\tvar sb = $('#newSide')\r\n\t\t\r\n\t\tif ( sb.is(':visible') ) {\r\n\t\t\tsb.toggle('slide');\r\n\t\t}\r\n\t}\r\n\tfunction discover(first, second, opt) {\r\n\t\tvar d = {\r\n\t\t\t\tStartRange: \"\",\r\n\t\t\t\tEndRange: \"\",\r\n\t\t\t\tIP: \"\",\r\n\t\t\t\tSubnet: \"\"\r\n\t\t\t};\r\n\t\t\r\n\t\tif (!opt) { // 0\r\n\t\t\td.StartRange = first;\r\n\t\t\td.EndRange = second;\r\n\t\t} else { // 1\r\n\t\t\td.IP = first;\r\n\t\t\td.Subnet = second;\r\n\t\t}\r\n\t\t\r\n\t\tpath += opt ? '?type=1': '?type=0';\r\n\t\t\r\n\t\tws = new WebSocket(path);\r\n\r\n\t\tws.onopen = function(e) {\r\n\t\t\tconsole.log(\"Connection open...\", e);\r\n\t\t\tws.send( JSON.stringify(d) );\r\n\t\t};\r\n\t\tws.onmessage = function(e) {\r\n\t\t\tvar data = e.data;\r\n\t\t\t\r\n\t\t\tcloseModal();\r\n\t\t\tcloseSidebar();\r\n\t\t\tif(typeof e.data === \"string\"){\r\n\t\t\t\tconsole.log(\"String message received\", e, e.data);\r\n\t\t\t\t\r\n\t\t\t\tdata = JSON.parse(data);\r\n\t\t\t\tcoefficient = {\r\n\t\t\t\t\tx: map.width / (300 + 80), // wpix.renderer.width / (300 + 80), // 600 80\r\n\t\t\t\t\ty: map.height / (300 + 80) // wpix.renderer.height / (300 + 80), // 600 80\r\n\t\t\t\t}\r\n\t\t\t//\ttpl.draw(data, \"viewport\", undefined, coefficient);\r\n\t\t\t\tmap.draw(data, \"viewport\", undefined, coefficient);\r\n\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"Other message received\", e, e.data);\r\n\t\t\t}\r\n\t\t};\r\n\t\tws.onerror = function(e) {\r\n\t\t\tconsole.log(\"WebSocket Error: \" , e);\r\n\t\t};\r\n\t\tws.onclose = function(e) {\r\n\t\t\tcloseModal();\r\n\t\t\tcloseSidebar();\r\n\t\t\tconsole.log(\"Connection closed\", e);\r\n\t\t};\r\n\t}\r\n\t\r\n\tinst.isValidIp = isValidIp;\r\n\tinst.discover = discover;\r\n\t\r\n\treturn inst;\r\n});"]}