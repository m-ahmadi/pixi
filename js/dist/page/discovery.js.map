{"version":3,"sources":["../../src/page/discovery.js"],"names":["define","map","wuk","inst","ws","path","window","location","host","coefficient","isValidIp","v","rgx","ip","ip1","test","doValidation","inputEl","el","val","res","startBtn","$","removeClass","addClass","enable","disable","closeModal","begin","openModal","closeSidebar","sb","is","toggle","discover","first","second","opt","d","StartRange","EndRange","IP","Subnet","WebSocket","onopen","e","console","log","send","JSON","stringify","onmessage","data","parse","x","width","y","height","draw","undefined","onerror","onclose","SL1_DEFAULT","SL2_DEFAULT","SL3_DEFAULT","initSliders","root","slider1","slider2","slider3","input1","input2","input3","noUiSlider","create","start","connect","range","min","max","on","a","b","c","toFixed","init","type","trim","discovery","parseInt","value"],"mappings":"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","file":"discovery.js","sourcesContent":["define(['map/mediator', 'core/wuk'], function (map, wuk) { // 'wpix', 'tpl' wpix, tpl\r\n\tvar inst = {},\r\n\t\tws,\r\n\t\tpath = 'ws://'+ window.location.host +'/network/discovery',\r\n\t\tcoefficient = {};\r\n\t\r\n\tfunction isValidIp(v) {\r\n\t\tvar rgx = {\r\n\t\t\tip: /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/, // regex cookbook\r\n\t\t\tip1: /^(([1-9]?\\d|1\\d\\d|2[0-5][0-5]|2[0-4]\\d)\\.){3}([1-9]?\\d|1\\d\\d|2[0-5][0-5]|2[0-4]\\d)$/         // stackoverflow\r\n\t\t};\r\n\t\t\r\n\t\treturn rgx.ip.test(v);\r\n\t}\r\n\tfunction doValidation(inputEl) {\r\n\t\tvar el = inputEl,\r\n\t\t\tval = el.val(),\r\n\t\t\tres = false,\r\n\t\t\tstartBtn = $('#discovery_next');\r\n\t\t\r\n\t\tres = isValidIp(val);\r\n\t\t\r\n\t\tinputEl.removeClass('uk-form-success uk-form-danger');\r\n\t\tif (res) {\r\n\t\t\tel.addClass('uk-form-success');\r\n\t\t\twuk.enable( startBtn );\r\n\t\t} else {\r\n\t\t\tel.addClass('uk-form-danger');\r\n\t\t\twuk.disable( startBtn );\r\n\t\t}\r\n\t}\r\n\tfunction closeModal() {\r\n\t\twuk.closeModal(\"#modal_discovery\");\r\n\t}\r\n\tfunction begin() {\r\n\t\twuk.openModal(\"#modal_discovery\");\r\n\t}\r\n\tfunction closeSidebar() {\r\n\t\tvar sb = $('#newSide')\r\n\t\t\r\n\t\tif ( sb.is(':visible') ) {\r\n\t\t\tsb.toggle('slide');\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction discover(first, second, opt) {\r\n\t\tvar d = {\r\n\t\t\t\tStartRange: \"\",\r\n\t\t\t\tEndRange: \"\",\r\n\t\t\t\tIP: \"\",\r\n\t\t\t\tSubnet: \"\"\r\n\t\t\t};\r\n\t\t\r\n\t\tif (!opt) { // 0\r\n\t\t\td.StartRange = first;\r\n\t\t\td.EndRange = second;\r\n\t\t} else { // 1\r\n\t\t\td.IP = first;\r\n\t\t\td.Subnet = second;\r\n\t\t}\r\n\t\t\r\n\t\tpath += opt ? '?type=1': '?type=0';\r\n\t\t\r\n\t\tws = new WebSocket(path);\r\n\r\n\t\tws.onopen = function(e) {\r\n\t\t\tconsole.log(\"Connection open...\", e);\r\n\t\t\tws.send( JSON.stringify(d) );\r\n\t\t};\r\n\t\tws.onmessage = function(e) {\r\n\t\t\tvar data = e.data;\r\n\t\t\t\r\n\t\t\tcloseModal();\r\n\t\t\tcloseSidebar();\r\n\t\t\tif(typeof e.data === \"string\"){\r\n\t\t\t\tconsole.log(\"String message received\", e, e.data);\r\n\t\t\t\t\r\n\t\t\t\tdata = JSON.parse(data);\r\n\t\t\t\tcoefficient = {\r\n\t\t\t\t\tx: map.width / (300 + 80), // wpix.renderer.width / (300 + 80), // 600 80\r\n\t\t\t\t\ty: map.height / (300 + 80) // wpix.renderer.height / (300 + 80), // 600 80\r\n\t\t\t\t}\r\n\t\t\t//\ttpl.draw(data, \"viewport\", undefined, coefficient);\r\n\t\t\t\tmap.draw(data, \"viewport\", undefined, coefficient);\r\n\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"Other message received\", e, e.data);\r\n\t\t\t}\r\n\t\t};\r\n\t\tws.onerror = function(e) {\r\n\t\t\tconsole.log(\"WebSocket Error: \" , e);\r\n\t\t};\r\n\t\tws.onclose = function(e) {\r\n\t\t\tcloseModal();\r\n\t\t\tcloseSidebar();\r\n\t\t\tconsole.log(\"Connection closed\", e);\r\n\t\t};\r\n\t}\r\n\t\r\n\t\r\n\tconst SL1_DEFAULT = 180;\r\n\tconst SL2_DEFAULT = 5;\r\n\tconst SL3_DEFAULT = 3;\r\n\tfunction initSliders() {\r\n\t\tlet root = \"#modal_timesettings\";\r\n\t\tlet slider1 = $(`${root} #discovery_timeout_slider`)[0];\r\n\t\tlet slider2 = $(`${root} #snpm_timout_slider`)[0];\r\n\t\tlet slider3 = $(`${root} #snpm_retries_slider`)[0];\r\n\t\tlet input1 = $(`${root} #discovery_timeout_input`);\r\n\t\tlet input2 = $(`${root} #snpm_timout_input`);\r\n\t\tlet input3 = $(`${root} #snpm_retries_input`);\r\n\t\t\r\n\t\tnoUiSlider.create(slider1, {\r\n\t\t\tstart: 180,\r\n\t\t\tconnect: [true, false],\r\n\t\t\trange: {\r\n\t\t\t\tmin: 10,\r\n\t\t\t\tmax: 600\r\n\t\t\t}\r\n\t\t});\r\n\t\tnoUiSlider.create(slider2, {\r\n\t\t\tstart: 5,\r\n\t\t\tconnect: [true, false],\r\n\t\t\trange: {\r\n\t\t\t\tmin: 1,\r\n\t\t\t\tmax: 10\r\n\t\t\t}\r\n\t\t});\r\n\t\tnoUiSlider.create(slider3, {\r\n\t\t\tstart: 3,\r\n\t\t\tconnect: [true, false],\r\n\t\t\trange: {\r\n\t\t\t\tmin: 1,\r\n\t\t\t\tmax: 10\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tslider1.noUiSlider.on(\"update\", function (a, b, c) {\r\n\t\t\tinput1.val( c[0].toFixed() );\r\n\t\t});\r\n\t\tslider2.noUiSlider.on(\"update\", function (a, b, c) {\r\n\t\t\tinput2.val( c[0].toFixed() );\r\n\t\t});\r\n\t\tslider3.noUiSlider.on(\"update\", function (a, b, c) {\r\n\t\t\tinput3.val( c[0].toFixed() );\r\n\t\t});\r\n\t}\r\n\tfunction init() {\r\n\t\tdoValidation( $('#disc_left_input') );\r\n\t\tdoValidation( $('#disc_right_input') );\r\n\t\t$('#discovery_next').on('click', function () {\r\n\t\t\tvar first, second, type;\r\n\t\t\t\r\n\t\t\tfirst = $('input[type=\"text\"][name=\"first-input\"]').val();\r\n\t\t\tsecond = $('input[type=\"text\"][name=\"second-input\"]').val();\r\n\t\t\t\r\n\t\t\tfirst = first ? first.trim() : '';\r\n\t\t\tsecond = second ? second.trim() : '';\r\n\t\t\t\r\n\t\t\ttype = $('#modal-discovery input[type=\"radio\"][name=\"radio1\"]:checked').val();\r\n\t\t\tdiscovery.discover( first, second, parseInt(type, 10) );\r\n\t\t\t\r\n\t\t});\r\n\t\t$('.j-discovery-radios').on('click', function () {\r\n\t\t\tvar val = parseInt(this.value, 10),\r\n\t\t\t\tfirst, second;\r\n\t\t\t\t\r\n\t\t\tfirst = $('input[type=\"text\"][name=\"first-input\"]');\r\n\t\t\tsecond = $('input[type=\"text\"][name=\"second-input\"]');\r\n\t\t\t\r\n\t\t\tif (!val) {\r\n\t\t\t\tfirst.val('192.168.1.1');\r\n\t\t\t\tsecond.val('192.168.1.255');\r\n\t\t\t} else {\r\n\t\t\t\tfirst.val('192.168.1.1');\r\n\t\t\t\tsecond.val('255.255.255.0');\r\n\t\t\t}\r\n\t\t\tdoValidation( $('#disc_left_input') );\r\n\t\t\tdoValidation( $('#disc_right_input') );\r\n\t\t});\r\n\t\t$('#disc_left_input').on('keyup', function () {\r\n\t\t\tdoValidation( $(this) );\r\n\t\t});\r\n\t\t$('#disc_right_input').on('keyup', function () {\r\n\t\t\tdoValidation( $(this) );\r\n\t\t});\r\n\t\t\r\n\t\tinitSliders();\r\n\t}\r\n\t\r\n\tinst.isValidIp = isValidIp;\r\n\tinst.discover = discover;\r\n\tinst.begin = begin;\r\n\tinst.init = init;\r\n\t\r\n\treturn inst;\r\n});"]}