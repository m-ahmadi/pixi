{"version":3,"sources":["../../src/page/discovery.js"],"names":["define","map","wuk","inst","ws","path","window","location","host","coefficient","isValidIp","v","rgx","ip","ip1","test","doValidation","inputEl","el","val","res","startBtn","$","discovery","removeClass","addClass","enable","disable","closeModal","u","closeSidebar","sb","is","toggle","discover","first","second","opt","d","StartRange","EndRange","IP","Subnet","WebSocket","onopen","e","console","log","send","JSON","stringify","onmessage","data","parse","x","width","y","height","draw","undefined","onerror","onclose","init","on","type","trim","parseInt","value"],"mappings":"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","file":"discovery.js","sourcesContent":["define(['map/mediator', 'core/wuk'], function (map, wuk) { // 'wpix', 'tpl' wpix, tpl\r\n\tvar inst = {},\r\n\t\tws,\r\n\t\tpath = 'ws://'+ window.location.host +'/network/discovery',\r\n\t\tcoefficient = {};\r\n\t\r\n\tfunction isValidIp(v) {\r\n\t\tvar rgx = {\r\n\t\t\tip: /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/, // regex cookbook\r\n\t\t\tip1: /^(([1-9]?\\d|1\\d\\d|2[0-5][0-5]|2[0-4]\\d)\\.){3}([1-9]?\\d|1\\d\\d|2[0-5][0-5]|2[0-4]\\d)$/         // stackoverflow\r\n\t\t};\r\n\t\t\r\n\t\treturn rgx.ip.test(v);\r\n\t}\r\n\tfunction doValidation(inputEl) {\r\n\t\tvar el = inputEl,\r\n\t\t\tval = el.val(),\r\n\t\t\tres = false,\r\n\t\t\tstartBtn = $('#discovery_next');\r\n\t\t\r\n\t\tres = discovery.isValidIp(val);\r\n\t\t\r\n\t\tinputEl.removeClass('uk-form-success uk-form-danger');\r\n\t\tif (res) {\r\n\t\t\tel.addClass('uk-form-success');\r\n\t\t\twuk.enable( startBtn );\r\n\t\t} else {\r\n\t\t\tel.addClass('uk-form-danger');\r\n\t\t\twuk.disable( startBtn );\r\n\t\t}\r\n\t}\r\n\tfunction closeModal() {\r\n\t\tvar u;\r\n\t\t// $('#newSide').toggle('slide');\r\n\t\t// $(\"body\").trigger( $.Event(\"keydown\", { keyCode: 27 }) );\r\n\t\t\r\n\t\t/* u = UIkit.modal('#modal_discovery')[0];\r\n\t\tif ( u.isActive() ) {\r\n\t\t\tu.close();\r\n\t\t} */\r\n\t\twuk.closeModal(\"#modal_discovery\");\r\n\t}\r\n\tfunction closeSidebar() {\r\n\t\tvar sb = $('#newSide')\r\n\t\t\r\n\t\tif ( sb.is(':visible') ) {\r\n\t\t\tsb.toggle('slide');\r\n\t\t}\r\n\t}\r\n\tfunction discover(first, second, opt) {\r\n\t\tvar d = {\r\n\t\t\t\tStartRange: \"\",\r\n\t\t\t\tEndRange: \"\",\r\n\t\t\t\tIP: \"\",\r\n\t\t\t\tSubnet: \"\"\r\n\t\t\t};\r\n\t\t\r\n\t\tif (!opt) { // 0\r\n\t\t\td.StartRange = first;\r\n\t\t\td.EndRange = second;\r\n\t\t} else { // 1\r\n\t\t\td.IP = first;\r\n\t\t\td.Subnet = second;\r\n\t\t}\r\n\t\t\r\n\t\tpath += opt ? '?type=1': '?type=0';\r\n\t\t\r\n\t\tws = new WebSocket(path);\r\n\r\n\t\tws.onopen = function(e) {\r\n\t\t\tconsole.log(\"Connection open...\", e);\r\n\t\t\tws.send( JSON.stringify(d) );\r\n\t\t};\r\n\t\tws.onmessage = function(e) {\r\n\t\t\tvar data = e.data;\r\n\t\t\t\r\n\t\t\tcloseModal();\r\n\t\t\tcloseSidebar();\r\n\t\t\tif(typeof e.data === \"string\"){\r\n\t\t\t\tconsole.log(\"String message received\", e, e.data);\r\n\t\t\t\t\r\n\t\t\t\tdata = JSON.parse(data);\r\n\t\t\t\tcoefficient = {\r\n\t\t\t\t\tx: map.width / (300 + 80), // wpix.renderer.width / (300 + 80), // 600 80\r\n\t\t\t\t\ty: map.height / (300 + 80) // wpix.renderer.height / (300 + 80), // 600 80\r\n\t\t\t\t}\r\n\t\t\t//\ttpl.draw(data, \"viewport\", undefined, coefficient);\r\n\t\t\t\tmap.draw(data, \"viewport\", undefined, coefficient);\r\n\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"Other message received\", e, e.data);\r\n\t\t\t}\r\n\t\t};\r\n\t\tws.onerror = function(e) {\r\n\t\t\tconsole.log(\"WebSocket Error: \" , e);\r\n\t\t};\r\n\t\tws.onclose = function(e) {\r\n\t\t\tcloseModal();\r\n\t\t\tcloseSidebar();\r\n\t\t\tconsole.log(\"Connection closed\", e);\r\n\t\t};\r\n\t}\r\n\tfunction init() {\r\n\t\tdoValidation( $('#disc_left_input') );\r\n\t\tdoValidation( $('#disc_right_input') );\r\n\t\t$('#discovery_next').on('click', function () {\r\n\t\t\tvar first, second, type;\r\n\t\t\t\r\n\t\t\tfirst = $('input[type=\"text\"][name=\"first-input\"]').val();\r\n\t\t\tsecond = $('input[type=\"text\"][name=\"second-input\"]').val();\r\n\t\t\t\r\n\t\t\tfirst = first ? first.trim() : '';\r\n\t\t\tsecond = second ? second.trim() : '';\r\n\t\t\t\r\n\t\t\ttype = $('#modal-discovery input[type=\"radio\"][name=\"radio1\"]:checked').val();\r\n\t\t\tdiscovery.discover( first, second, parseInt(type, 10) );\r\n\t\t\t\r\n\t\t});\r\n\t\t$('.j-discovery-radios').on('click', function () {\r\n\t\t\tvar val = parseInt(this.value, 10),\r\n\t\t\t\tfirst, second;\r\n\t\t\t\t\r\n\t\t\tfirst = $('input[type=\"text\"][name=\"first-input\"]');\r\n\t\t\tsecond = $('input[type=\"text\"][name=\"second-input\"]');\r\n\t\t\t\r\n\t\t\tif (!val) {\r\n\t\t\t\tfirst.val('192.168.1.1');\r\n\t\t\t\tsecond.val('192.168.1.255');\r\n\t\t\t} else {\r\n\t\t\t\tfirst.val('192.168.1.1');\r\n\t\t\t\tsecond.val('255.255.255.0');\r\n\t\t\t}\r\n\t\t\tdoValidation( $('#disc_left_input') );\r\n\t\t\tdoValidation( $('#disc_right_input') );\r\n\t\t});\r\n\t\t$('#disc_left_input').on('keyup', function () {\r\n\t\t\tdoValidation( $(this) );\r\n\t\t});\r\n\t\t$('#disc_right_input').on('keyup', function () {\r\n\t\t\tdoValidation( $(this) );\r\n\t\t});\r\n\t}\r\n\t\r\n\tinst.isValidIp = isValidIp;\r\n\tinst.discover = discover;\r\n\tinst.init = init;\r\n\t\r\n\treturn inst;\r\n});"]}